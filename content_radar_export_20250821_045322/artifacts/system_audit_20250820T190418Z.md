# System Audit Report
_Generated: Wed Aug 20 07:04:18 PM UTC 2025_

## Environment & Toolchain

- Node: v20.19.3
- npm:  10.8.2
- pnpm: 9.12.2
- Package manager used for audit: pnpm

## package.json Snapshot

Name: rest-express
Version: 1.0.0

Scripts:
- dev: concurrently -k -n server,client -c cyan,magenta "npm:dev:server" "npm:dev:client"
- build: vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist && esbuild server/prod-server.ts --platform=node --packages=external --bundle --format=esm --outdir=dist
- start: NODE_ENV=production node dist/prod-server.js
- check: tsc
- db:push: drizzle-kit push
- typecheck: tsc --noEmit
- verify: npm run typecheck && npm run lint && npm run build
- zip:extension: bash scripts/zip-extension.sh
- dev:server: VITE_UIV2_MOCK=0 NODE_ENV=production npx tsx server/index.ts
- dev:client: VITE_UIV2_MOCK=0 vite

Key deps:
- react: ^18.3.1
- react-dom: ^18.3.1
- vite: ^5.4.19
- @vitejs/plugin-react: ^4.7.0
- typescript: ^5.9.2
- esbuild: ^0.25.9
- tailwindcss: ^4.1.12
- @tailwindcss/postcss: ^4.1.12
- concurrently: ^9.2.0
- tsx: ^4.20.4

## Dependency Integrity (presence)

Legend: production dependency, optional only, dev only

rest-express@1.0.0 /home/runner/workspace

dependencies:
concurrently 9.2.0
esbuild 0.25.9
react 18.3.1
react-dom 18.3.1

## Build Configuration

- postcss.config.cjs:
  module.exports = { 
    plugins: { 
      "@tailwindcss/postcss": {},
      "autoprefixer": {}
    } 
  };
- tailwind.config.*:
  tailwind.config.ts
- vite.config.ts:
  import { defineConfig } from "vite";
  import react from "@vitejs/plugin-react";
  import path from "path";
  import fs from "fs";
  
  const hasClient = fs.existsSync(path.resolve(__dirname, "client"));
  const root = hasClient ? path.resolve(__dirname, "client") : path.resolve(__dirname);
  
  export default defineConfig({
    root,
    plugins: [react()],
    resolve: {
      alias: {
        "@": path.resolve(root, "src"),
        "@ui": path.resolve(root, "src/ui-v2"),
      },
    },
    server: {
      port: 5173,
      strictPort: true,
      proxy: { "/api": "http://localhost:5000" },
    },
    build: {
      outDir: hasClient ? path.resolve(__dirname, "client/dist") : "dist",
      emptyOutDir: true,
    },
  });

## Security & Hardening (static scan)

- Helmet usage:
server/index.ts:5:import helmet from "helmet";
- Rate limiting middleware:
server/middleware/rateLimit.ts:1:import rateLimit from "express-rate-limit";
server/middleware/requestValidation.ts:3:// Rate limiting functionality (install express-rate-limit if needed)
server/middleware/requestValidation.ts:61:// Simple rate limiting (can be enhanced with express-rate-limit)
server/routes.ts:23:import rateLimit from "express-rate-limit";
- CORS middleware (strict):
server/index.ts:15:import { corsMiddleware } from "./lib/cors";
server/index.ts:62:app.use("/api", corsMiddleware);
server/lib/cors.ts:24:export const corsMiddleware = cors({
- Project scope middleware:
server/index.ts:17:import { projectScope } from "./middleware/project-scope";
server/routes/daily.ts:3:import type { ProjectScopedRequest } from "../middleware/project-scope";
- Auth enforcement (requireAuth):
server/middleware/supabase-auth.ts:21:export async function requireAuth(req: Request, res: Response, next: NextFunction) {
server/middleware/supabase-auth.ts:45:    console.error("requireAuth error:", err);
server/routes.ts:20:import { requireAuth, AuthedRequest } from "./middleware/supabase-auth";
server/routes.ts:334:    requireAuth,
server/routes.ts:368:  app.get("/api/jobs/:id", requireAuth, async (req: AuthedRequest, res) => {
server/routes.ts:1434:    requireAuth,
server/routes.ts:1914:    requireAuth,
server/routes.ts:2069:    requireAuth,
server/routes.ts:2117:    requireAuth,
server/routes/admin-analysis.ts:2:import { requireAuth } from '../middleware/supabase-auth';
server/routes/admin-analysis.ts:9:r.post('/captures/:id/rebuild-readmodel', requireAuth, async (req: any, res) => {
server/routes/ai.ts:2:import { requireAuth } from "../middleware/supabase-auth";
server/routes/ai.ts:17:aiRouter.post("/ai/analyze", heavyLimiter, requireAuth, validateBody(aiAnalyzeSchema), async (req: ValidatedRequest<z.infer<typeof aiAnalyzeSchema>>, res: Response) => {
server/routes/ai.ts:51:aiRouter.post("/ai/hook-generator", requireAuth, validateBody(hookGenSchema), async (req: ValidatedRequest<z.infer<typeof hookGenSchema>>, res: Response) => {
server/routes/analysis.ts:3:import { requireAuth, AuthedRequest } from "../middleware/supabase-auth";
server/routes/analysis.ts:9:router.post("/captures/upload-and-analyze", requireAuth, analysisService.uploadAndAnalyze);
server/routes/analysis.ts:12:router.post("/captures/:id/analyze", requireAuth, analysisService.analyzeExisting);
server/routes/analysis.ts:15:router.get("/captures/:id/analysis", requireAuth, analysisService.getLatestForCapture);
server/routes/analysis.ts:18:router.get("/analysis/:jobId", requireAuth, analysisService.getJobStatus);
server/routes/brief-blocks.ts:3:import { requireAuth, AuthedRequest } from '../middleware/supabase-auth';
server/routes/brief-blocks.ts:31:router.get('/api/briefs/:id/blocks', requireAuth, async (req: AuthedRequest, res) => {
server/routes/brief-blocks.ts:51:router.post('/api/briefs/:id/blocks', requireAuth, async (req: AuthedRequest, res) => {
server/routes/brief-blocks.ts:72:router.patch('/api/briefs/:id/blocks/:blockId', requireAuth, async (req: AuthedRequest, res) => {
server/routes/brief-blocks.ts:96:router.delete('/api/briefs/:id/blocks/:blockId', requireAuth, async (req: AuthedRequest, res) => {
server/routes/brief-canvas.ts:3:import { requireAuth } from "../middleware/supabase-auth";
server/routes/brief-canvas.ts:9:router.use(requireAuth);
server/routes/briefs.ts:2:import { requireAuth } from "../middleware/supabase-auth";
server/routes/briefs.ts:7:r.use(requireAuth);
server/routes/brightData.ts:2:import { requireAuth } from "../middleware/supabase-auth";
server/routes/brightData.ts:19:brightDataRouter.post("/bright-data/fetch", heavyLimiter, requireAuth, validateBody(brightFetchSchema), async (req: ValidatedRequest<z.infer<typeof brightFetchSchema>>, res: Response) => {
server/routes/brightData.ts:46:brightDataRouter.post("/bright-data/live", heavyLimiter, requireAuth, validateBody(brightLiveSchema), async (req: ValidatedRequest<z.infer<typeof brightLiveSchema>>, res: Response) => {
server/routes/capture-analysis.ts:3:import { requireAuth } from '../middleware/supabase-auth';
server/routes/capture-analysis.ts:9:r.get('/:id/shots', requireAuth, async (req: Request, res: Response) => {
server/routes/capture-analysis.ts:27:r.get('/:id/keyframes', requireAuth, async (req: Request, res: Response) => {
server/routes/capture-analysis.ts:47:r.get('/:id/transcript', requireAuth, async (req: Request, res: Response) => {
server/routes/capture-analysis.ts:65:r.get('/:id/ocr', requireAuth, async (req: Request, res: Response) => {
server/routes/capture-analysis.ts:82:r.get('/:id/detections', requireAuth, async (req: Request, res: Response) => {
server/routes/capture-analysis.ts:99:r.get('/:id/captions', requireAuth, async (req: Request, res: Response) => {
server/routes/captures.ts:2:import { requireAuth } from "../middleware/supabase-auth";
server/routes/captures.ts:10:r.use(requireAuth);
server/routes/captures.ts:134:r.post("/upload", requireAuth, memoryUpload.array("files", MAX_FILES), async (req, res) => {
server/routes/content.ts:2:import { requireAuth, AuthedRequest } from "../middleware/supabase-auth";
server/routes/content.ts:13:contentRouter.get("/content", requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/content.ts:75:contentRouter.get("/content/:id", requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/content.ts:86:contentRouter.post("/content", requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/content.ts:100:contentRouter.patch("/content/:id", requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/content.ts:111:contentRouter.delete("/content/:id", requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/content.ts:121:contentRouter.post("/content/:id/hooks", requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/content.ts:140:contentRouter.post("/content/scan", requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/ext-tokens.ts:4:import { requireAuth } from '../middleware/supabase-auth';
server/routes/ext-tokens.ts:11:router.post('/', requireAuth, async (req: Request, res: Response) => {
server/routes/ext-tokens.ts:34:router.delete('/:id', requireAuth, async (req: Request, res: Response) => {
server/routes/ext-tokens.ts:47:router.get('/', requireAuth, async (req: Request, res: Response) => {
server/routes/extension.ts:5:import { requireAuth } from "../middleware/supabase-auth"; // your existing middleware that adds req.user
server/routes/extension.ts:17:r.post("/pairing-codes", requireAuth, async (req: any, res, next) => {
server/routes/extension.ts:97:r.get("/devices", requireAuth, async (req: any, res, next) => {
server/routes/extension.ts:105:r.patch("/devices/:id", requireAuth, async (req: any, res, next) => {
server/routes/feeds.ts:2:import { requireAuth } from "../middleware/supabase-auth";
server/routes/feeds.ts:7:r.use(requireAuth);
server/routes/google-export.ts:2:import { requireAuth, AuthedRequest } from "../middleware/supabase-auth";
server/routes/google-export.ts:31:  app.post("/api/briefs/:id/export/slides", requireAuth, async (req: AuthedRequest, res) => {
server/routes/google-export.ts:135:  app.get("/api/auth/google", requireAuth, async (req: AuthedRequest, res) => {
server/routes/google-export.ts:149:  app.get("/api/auth/google/callback", requireAuth, async (req: AuthedRequest, res) => {
server/routes/google-exports.ts:10:import { requireAuth } from '../middleware/supabase-auth';
server/routes/google-exports.ts:32:router.get('/auth/google', requireAuth, (req, res) => {
server/routes/google-exports.ts:43:router.get('/auth/google/callback', requireAuth, async (req, res) => {
server/routes/google-exports.ts:65:router.post('/brief', requireAuth, async (req, res) => {
server/routes/google-exports.ts:143:router.post('/export', requireAuth, async (req, res) => {
server/routes/google-exports.ts:244:router.get('/auth/status', requireAuth, (req, res) => {
server/routes/google-exports.ts:263:router.post('/analyze/vision', requireAuth, async (req, res) => {
server/routes/google-exports.ts:290:router.post('/analyze/nlp', requireAuth, async (req, res) => {
server/routes/google-exports.ts:314:router.post('/export/project/:projectId', requireAuth, async (req, res) => {
server/routes/intelligence.ts:2:import { requireAuth, AuthedRequest } from "../middleware/supabase-auth";
server/routes/intelligence.ts:24:  requireAuth,
server/routes/intelligence.ts:51:  requireAuth,
server/routes/jobs.ts:2:import { requireAuth, AuthedRequest } from "../middleware/supabase-auth";
server/routes/jobs.ts:20:  requireAuth,
server/routes/jobs.ts:42:  requireAuth,
server/routes/jobs.ts:56:jobsRouter.get("/jobs/:id", publicLimiter, requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/media-analysis.ts:3:import { requireAuth, AuthedRequest } from '../middleware/supabase-auth';
server/routes/media-analysis.ts:52:router.post('/api/media/analyze/quick', requireAuth, async (req: AuthedRequest, res) => {
server/routes/media-analysis.ts:96:router.post('/api/media/analyze/deep', requireAuth, async (req: AuthedRequest, res) => {
server/routes/media-analysis.ts:115:router.get('/api/media/jobs/:jobId', requireAuth, async (req: AuthedRequest, res) => {
server/routes/moments.ts:3:import { requireAuth } from '../middleware/supabase-auth';
server/routes/moments.ts:21:router.get('/', requireAuth, async (req: Request, res: Response) => {
server/routes/moments.ts:67:router.get('/stream', requireAuth, async (req: Request, res: Response) => {
server/routes/moments.ts:100:router.post('/refresh', requireAuth, async (_req: Request, res: Response) => {
server/routes/projects.ts:4:import { requireAuth } from "../middleware/supabase-auth";
server/routes/projects.ts:10:  app.get('/api/projects', requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/projects.ts:25:  app.post('/api/projects', requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/projects.ts:48:  app.patch('/api/projects/:id', requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/projects.ts:72:  app.delete('/api/projects/:id', requireAuth, async (req: AuthedRequest, res: Response) => {
server/routes/search.ts:3:import { requireAuth } from '../middleware/supabase-auth';
server/routes/search.ts:9:r.get('/similar', requireAuth, async (req: Request, res: Response) => {
server/routes/uploads.ts:3:import { requireAuth, AuthedRequest } from '../middleware/supabase-auth';
server/routes/uploads.ts:17:router.post('/api/uploads/brief-asset', requireAuth, async (req: AuthedRequest, res) => {
- Dev/mock flags (should be dev-only):
client/src/ui-v2/hooks/useAuth.ts:37:      localStorage.setItem("sb-access-token", "mock-token");
client/src/ui-v2/lib/api.ts:11:  (typeof import.meta !== "undefined" && import.meta.env?.VITE_MOCK_AUTH === "1") || false;
client/src/ui-v2/lib/api.ts:22:    return token || "dev-mock-token";
client/src/ui-v2/lib/api.ts:23:  } catch { return "dev-mock-token"; }
server/lib/env.ts:19:  MOCK_AUTH: z.enum(["0","1"]).default("0"),
server/middleware/supabase-auth.ts:27:    if (env.NODE_ENV !== "production" && env.MOCK_AUTH === "1" &&
server/middleware/supabase-auth.ts:28:        (!token || token === "dev-mock-token" || token === "mock-token")) {
server/public/assets/index-B7xfy0OJ.js:48: */var Ws=p;function Ej(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Pj=typeof Object.is=="function"?Object.is:Ej,Tj=Ws.useState,Aj=Ws.useEffect,Rj=Ws.useLayoutEffect,Mj=Ws.useDebugValue;function Dj(e,t){var n=t(),r=Tj({inst:{value:n,getSnapshot:t}}),s=r[0].inst,i=r[1];return Rj(function(){s.value=n,s.getSnapshot=t,Mc(s)&&i({inst:s})},[e,n,t]),Aj(function(){return Mc(s)&&i({inst:s}),e(function(){Mc(s)&&i({inst:s})})},[e]),Mj(n),n}function Mc(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Pj(e,n)}catch{return!0}}function Lj(e,t){return t()}var Ij=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Lj:Dj;kx.useSyncExternalStore=Ws.useSyncExternalStore!==void 0?Ws.useSyncExternalStore:Ij;jx.exports=kx;var Oj=jx.exports;const Fj=zd.useInsertionEffect,_j=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Vj=_j?p.useLayoutEffect:p.useEffect,zj=Fj||Vj,Sx=e=>{const t=p.useRef([e,(...n)=>t[0](...n)]).current;return zj(()=>{t[0]=e}),t[1]},Bj="popstate",Df="pushState",Lf="replaceState",Uj="hashchange",Kp=[Bj,Df,Lf,Uj],$j=e=>{for(const t of Kp)addEventListener(t,e);return()=>{for(const t of Kp)removeEventListener(t,e)}},Nx=(e,t)=>Oj.useSyncExternalStore($j,e,t),Hj=()=>location.search,Wj=({ssrSearch:e=""}={})=>Nx(Hj,()=>e),Qp=()=>location.pathname,Kj=({ssrPath:e}={})=>Nx(Qp,e?()=>e:Qp),Qj=(e,{replace:t=!1,state:n=null}={})=>history[t?Lf:Df](n,"",e),Gj=(e={})=>[Kj(e),Qj],Gp=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[Gp]>"u"){for(const e of[Df,Lf]){const t=history[e];history[e]=function(){const n=t.apply(this,arguments),r=new Event(e);return r.arguments=arguments,dispatchEvent(r),n}}Object.defineProperty(window,Gp,{value:!0})}const qj=(e,t)=>t.toLowerCase().indexOf(e.toLowerCase())?"~"+t:t.slice(e.length)||"/",Cx=(e="")=>e==="/"?"":e,Yj=(e,t)=>e[0]==="~"?e.slice(1):Cx(t)+e,Xj=(e="",t)=>qj(qp(Cx(e)),qp(t)),qp=e=>{try{return decodeURI(e)}catch{return e}},Ex={hook:Gj,searchHook:Wj,parser:Cj,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:e=>e},Px=p.createContext(Ex),ti=()=>p.useContext(Px),Tx={},Ax=p.createContext(Tx),Rx=()=>p.useContext(Ax),Vl=e=>{const[t,n]=e.hook(e);return[Xj(e.base,t),Sx((r,s)=>n(Yj(r,e.base),s))]},ni=()=>Vl(ti()),If=(e,t,n,r)=>{const{pattern:s,keys:i}=t instanceof RegExp?{keys:!1,pattern:t}:e(t||"*",r),o=s.exec(n)||[],[l,...c]=o;return l!==void 0?[!0,(()=>{const u=i!==!1?Object.fromEntries(i.map((f,h)=>[f,c[h]])):o.groups;let d={...c};return u&&Object.assign(d,u),d})(),...r?[l]:[]]:[!1,null]},Zj=e=>If(ti().parser,e,ni()[0]),Mx=({children:e,...t})=>{var d,f;const n=ti(),r=t.hook?Ex:n;let s=r;const[i,o]=((d=t.ssrPath)==null?void 0:d.split("?"))??[];o&&(t.ssrSearch=o,t.ssrPath=i),t.hrefs=t.hrefs??((f=t.hook)==null?void 0:f.hrefs);let l=p.useRef({}),c=l.current,u=c;for(let h in r){const x=h==="base"?r[h]+(t[h]||""):t[h]||r[h];c===u&&x!==u[h]&&(l.current=u={...u}),u[h]=x,(x!==r[h]||x!==s[h])&&(s=u)}return p.createElement(Px.Provider,{value:s,children:e})},Yp=({children:e,component:t},n)=>t?p.createElement(t,{params:n}):typeof e=="function"?e(n):e,Jj=e=>{let t=p.useRef(Tx);const n=t.current;return t.current=Object.keys(e).length!==Object.keys(n).length||Object.entries(e).some(([r,s])=>s!==n[r])?e:n},ct=({path:e,nest:t,match:n,...r})=>{const s=ti(),[i]=Vl(s),[o,l,c]=n??If(s.parser,e,i,t),u=Jj({...Rx(),...l});if(!o)return null;const d=c?p.createElement(Mx,{base:c},Yp(r,u)):Yp(r,u);return p.createElement(Ax.Provider,{value:u,children:d})},gt=p.forwardRef((e,t)=>{const n=ti(),[r,s]=Vl(n),{to:i="",href:o=i,onClick:l,asChild:c,children:u,className:d,replace:f,state:h,...x}=e,w=Sx(b=>{b.ctrlKey||b.metaKey||b.altKey||b.shiftKey||b.button!==0||(l==null||l(b),b.defaultPrevented||(b.preventDefault(),s(o,e)))}),v=n.hrefs(o[0]==="~"?o.slice(1):n.base+o,n);return c&&p.isValidElement(u)?p.cloneElement(u,{onClick:w,href:v}):p.createElement("a",{...x,onClick:w,href:v,className:d!=null&&d.call?d(r===o):d,children:u,ref:t})}),Dx=e=>Array.isArray(e)?e.flatMap(t=>Dx(t&&t.type===p.Fragment?t.props.children:t)):[e],ek=({children:e,location:t})=>{const n=ti(),[r]=Vl(n);for(const s of Dx(e)){let i=0;if(p.isValidElement(s)&&(i=If(n.parser,s.props.path,t||r,s.props.nest))[0])return p.cloneElement(s,{match:i})}return null};var ri=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Fr=typeof window>"u"||"Deno"in globalThis;function Ve(){}function tk(e,t){return typeof e=="function"?e(t):e}function ed(e){return typeof e=="number"&&e>=0&&e!==1/0}function Lx(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Jn(e,t){return typeof e=="function"?e(t):e}function ht(e,t){return typeof e=="function"?e(t):e}function Xp(e,t){const{type:n="all",exact:r,fetchStatus:s,predicate:i,queryKey:o,stale:l}=e;if(o){if(r){if(t.queryHash!==Of(o,t.options))return!1}else if(!fo(t.queryKey,o))return!1}if(n!=="all"){const c=t.isActive();if(n==="active"&&!c||n==="inactive"&&c)return!1}return!(typeof l=="boolean"&&t.isStale()!==l||s&&s!==t.state.fetchStatus||i&&!i(t))}function Zp(e,t){const{exact:n,status:r,predicate:s,mutationKey:i}=e;if(i){if(!t.options.mutationKey)return!1;if(n){if(_r(t.options.mutationKey)!==_r(i))return!1}else if(!fo(t.options.mutationKey,i))return!1}return!(r&&t.state.status!==r||s&&!s(t))}function Of(e,t){return((t==null?void 0:t.queryKeyHashFn)||_r)(e)}function _r(e){return JSON.stringify(e,(t,n)=>td(n)?Object.keys(n).sort().reduce((r,s)=>(r[s]=n[s],r),{}):n)}function fo(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>fo(e[n],t[n])):!1}function Ix(e,t){if(e===t)return e;const n=Jp(e)&&Jp(t);if(n||td(e)&&td(t)){const r=n?e:Object.keys(e),s=r.length,i=n?t:Object.keys(t),o=i.length,l=n?[]:{},c=new Set(r);let u=0;for(let d=0;d<o;d++){const f=n?d:i[d];(!n&&c.has(f)||n)&&e[f]===void 0&&t[f]===void 0?(l[f]=void 0,u++):(l[f]=Ix(e[f],t[f]),l[f]===e[f]&&e[f]!==void 0&&u++)}return s===o&&u===s?e:l}return t}function cl(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function Jp(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function td(e){if(!em(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!em(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function em(e){return Object.prototype.toString.call(e)==="[object Object]"}function nk(e){return new Promise(t=>{setTimeout(t,e)})}function nd(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?Ix(e,t):t}function rk(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function sk(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var Ff=Symbol();function Ox(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===Ff?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function Fx(e,t){return typeof e=="function"?e(...t):!!e}var br,Dn,Ns,Zg,ik=(Zg=class extends ri{constructor(){super();I(this,br);I(this,Dn);I(this,Ns);M(this,Ns,t=>{if(!Fr&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){k(this,Dn)||this.setEventListener(k(this,Ns))}onUnsubscribe(){var t;this.hasListeners()||((t=k(this,Dn))==null||t.call(this),M(this,Dn,void 0))}setEventListener(t){var n;M(this,Ns,t),(n=k(this,Dn))==null||n.call(this),M(this,Dn,t(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(t){k(this,br)!==t&&(M(this,br,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof k(this,br)=="boolean"?k(this,br):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},br=new WeakMap,Dn=new WeakMap,Ns=new WeakMap,Zg),_f=new ik,Cs,Ln,Es,Jg,ok=(Jg=class extends ri{constructor(){super();I(this,Cs,!0);I(this,Ln);I(this,Es);M(this,Es,t=>{if(!Fr&&window.addEventListener){const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){k(this,Ln)||this.setEventListener(k(this,Es))}onUnsubscribe(){var t;this.hasListeners()||((t=k(this,Ln))==null||t.call(this),M(this,Ln,void 0))}setEventListener(t){var n;M(this,Es,t),(n=k(this,Ln))==null||n.call(this),M(this,Ln,t(this.setOnline.bind(this)))}setOnline(t){k(this,Cs)!==t&&(M(this,Cs,t),this.listeners.forEach(r=>{r(t)}))}isOnline(){return k(this,Cs)}},Cs=new WeakMap,Ln=new WeakMap,Es=new WeakMap,Jg),ul=new ok;function rd(){let e,t;const n=new Promise((s,i)=>{e=s,t=i});n.status="pending",n.catch(()=>{});function r(s){Object.assign(n,s),delete n.resolve,delete n.reject}return n.resolve=s=>{r({status:"fulfilled",value:s}),e(s)},n.reject=s=>{r({status:"rejected",reason:s}),t(s)},n}function ak(e){return Math.min(1e3*2**e,3e4)}function _x(e){return(e??"online")==="online"?ul.isOnline():!0}var Vx=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function zx(e){let t=!1,n=0,r;const s=rd(),i=()=>s.status!=="pending",o=v=>{var b;i()||(h(new Vx(v)),(b=e.abort)==null||b.call(e))},l=()=>{t=!0},c=()=>{t=!1},u=()=>_f.isFocused()&&(e.networkMode==="always"||ul.isOnline())&&e.canRun(),d=()=>_x(e.networkMode)&&e.canRun(),f=v=>{i()||(r==null||r(),s.resolve(v))},h=v=>{i()||(r==null||r(),s.reject(v))},x=()=>new Promise(v=>{var b;r=m=>{(i()||u())&&v(m)},(b=e.onPause)==null||b.call(e)}).then(()=>{var v;r=void 0,i()||(v=e.onContinue)==null||v.call(e)}),w=()=>{if(i())return;let v;const b=n===0?e.initialPromise:void 0;try{v=b??e.fn()}catch(m){v=Promise.reject(m)}Promise.resolve(v).then(f).catch(m=>{var N;if(i())return;const g=e.retry??(Fr?0:3),y=e.retryDelay??ak,j=typeof y=="function"?y(n,m):y,S=g===!0||typeof g=="number"&&n<g||typeof g=="function"&&g(n,m);if(t||!S){h(m);return}n++,(N=e.onFail)==null||N.call(e,n,m),nk(j).then(()=>u()?void 0:x()).then(()=>{t?h(m):w()})})};return{promise:s,status:()=>s.status,cancel:o,continue:()=>(r==null||r(),s),cancelRetry:l,continueRetry:c,canStart:d,start:()=>(d()?w():x().then(w),s)}}var lk=e=>setTimeout(e,0);function ck(){let e=[],t=0,n=l=>{l()},r=l=>{l()},s=lk;const i=l=>{t?e.push(l):s(()=>{n(l)})},o=()=>{const l=e;e=[],l.length&&s(()=>{r(()=>{l.forEach(c=>{n(c)})})})};return{batch:l=>{let c;t++;try{c=l()}finally{t--,t||o()}return c},batchCalls:l=>(...c)=>{i(()=>{l(...c)})},schedule:i,setNotifyFunction:l=>{n=l},setBatchNotifyFunction:l=>{r=l},setScheduler:l=>{s=l}}}var pe=ck(),jr,ey,Bx=(ey=class{constructor(){I(this,jr)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ed(this.gcTime)&&M(this,jr,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Fr?1/0:5*60*1e3))}clearGcTimeout(){k(this,jr)&&(clearTimeout(k(this,jr)),M(this,jr,void 0))}},jr=new WeakMap,ey),Ps,Ts,ft,kr,xe,jo,Sr,Ct,Zt,ty,uk=(ty=class extends Bx{constructor(t){super();I(this,Ct);I(this,Ps);I(this,Ts);I(this,ft);I(this,kr);I(this,xe);I(this,jo);I(this,Sr);M(this,Sr,!1),M(this,jo,t.defaultOptions),this.setOptions(t.options),this.observers=[],M(this,kr,t.client),M(this,ft,k(this,kr).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,M(this,Ps,dk(this.options)),this.state=t.state??k(this,Ps),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=k(this,xe))==null?void 0:t.promise}setOptions(t){this.options={...k(this,jo),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&k(this,ft).remove(this)}setData(t,n){const r=nd(this.state.data,t,this.options);return U(this,Ct,Zt).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(t,n){U(this,Ct,Zt).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var r,s;const n=(r=k(this,xe))==null?void 0:r.promise;return(s=k(this,xe))==null||s.cancel(t),n?n.then(Ve).catch(Ve):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(k(this,Ps))}isActive(){return this.observers.some(t=>ht(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Ff||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Jn(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Lx(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=k(this,xe))==null||n.continue()}onOnline(){var n;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=k(this,xe))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),k(this,ft).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(k(this,xe)&&(k(this,Sr)?k(this,xe).cancel({revert:!0}):k(this,xe).cancelRetry()),this.scheduleGc()),k(this,ft).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||U(this,Ct,Zt).call(this,{type:"invalidate"})}async fetch(t,n){var c,u,d,f,h,x,w,v,b,m,g,y;if(this.state.fetchStatus!=="idle"&&((c=k(this,xe))==null?void 0:c.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(k(this,xe))return k(this,xe).continueRetry(),k(this,xe).promise}if(t&&this.setOptions(t),!this.options.queryFn){const j=this.observers.find(S=>S.options.queryFn);j&&this.setOptions(j.options)}const r=new AbortController,s=j=>{Object.defineProperty(j,"signal",{enumerable:!0,get:()=>(M(this,Sr,!0),r.signal)})},i=()=>{const j=Ox(this.options,n),N=(()=>{const C={client:k(this,kr),queryKey:this.queryKey,meta:this.meta};return s(C),C})();return M(this,Sr,!1),this.options.persister?this.options.persister(j,N,this):j(N)},l=(()=>{const j={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:k(this,kr),state:this.state,fetchFn:i};return s(j),j})();(u=this.options.behavior)==null||u.onFetch(l,this),M(this,Ts,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((d=l.fetchOptions)==null?void 0:d.meta))&&U(this,Ct,Zt).call(this,{type:"fetch",meta:(f=l.fetchOptions)==null?void 0:f.meta}),M(this,xe,zx({initialPromise:n==null?void 0:n.initialPromise,fn:l.fetchFn,abort:r.abort.bind(r),onFail:(j,S)=>{U(this,Ct,Zt).call(this,{type:"failed",failureCount:j,error:S})},onPause:()=>{U(this,Ct,Zt).call(this,{type:"pause"})},onContinue:()=>{U(this,Ct,Zt).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0}));try{const j=await k(this,xe).start();if(j===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(j),(x=(h=k(this,ft).config).onSuccess)==null||x.call(h,j,this),(v=(w=k(this,ft).config).onSettled)==null||v.call(w,j,this.state.error,this),j}catch(j){if(j instanceof Vx){if(j.silent)return k(this,xe).promise;if(j.revert)return this.setState({...k(this,Ts),fetchStatus:"idle"}),this.state.data}throw U(this,Ct,Zt).call(this,{type:"error",error:j}),(m=(b=k(this,ft).config).onError)==null||m.call(b,j,this),(y=(g=k(this,ft).config).onSettled)==null||y.call(g,this.state.data,j,this),j}finally{this.scheduleGc()}}},Ps=new WeakMap,Ts=new WeakMap,ft=new WeakMap,kr=new WeakMap,xe=new WeakMap,jo=new WeakMap,Sr=new WeakMap,Ct=new WeakSet,Zt=function(t){const n=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...Ux(r.data,this.options),fetchMeta:t.meta??null};case"success":const s={...r,data:t.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return M(this,Ts,t.manual?s:void 0),s;case"error":const i=t.error;return{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=n(this.state),pe.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),k(this,ft).notify({query:this,type:"updated",action:t})})},ty);function Ux(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:_x(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function dk(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,r=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var _t,ny,fk=(ny=class extends ri{constructor(t={}){super();I(this,_t);this.config=t,M(this,_t,new Map)}build(t,n,r){const s=n.queryKey,i=n.queryHash??Of(s,n);let o=this.get(i);return o||(o=new uk({client:t,queryKey:s,queryHash:i,options:t.defaultQueryOptions(n),state:r,defaultOptions:t.getQueryDefaults(s)}),this.add(o)),o}add(t){k(this,_t).has(t.queryHash)||(k(this,_t).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=k(this,_t).get(t.queryHash);n&&(t.destroy(),n===t&&k(this,_t).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){pe.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return k(this,_t).get(t)}getAll(){return[...k(this,_t).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(r=>Xp(n,r))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(r=>Xp(t,r)):n}notify(t){pe.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){pe.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){pe.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},_t=new WeakMap,ny),Vt,Oe,Nr,zt,Cn,ry,hk=(ry=class extends Bx{constructor(t){super();I(this,zt);I(this,Vt);I(this,Oe);I(this,Nr);this.mutationId=t.mutationId,M(this,Oe,t.mutationCache),M(this,Vt,[]),this.state=t.state||$x(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){k(this,Vt).includes(t)||(k(this,Vt).push(t),this.clearGcTimeout(),k(this,Oe).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){M(this,Vt,k(this,Vt).filter(n=>n!==t)),this.scheduleGc(),k(this,Oe).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){k(this,Vt).length||(this.state.status==="pending"?this.scheduleGc():k(this,Oe).remove(this))}continue(){var t;return((t=k(this,Nr))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var i,o,l,c,u,d,f,h,x,w,v,b,m,g,y,j,S,N,C,E;const n=()=>{U(this,zt,Cn).call(this,{type:"continue"})};M(this,Nr,zx({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(P,T)=>{U(this,zt,Cn).call(this,{type:"failed",failureCount:P,error:T})},onPause:()=>{U(this,zt,Cn).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>k(this,Oe).canRun(this)}));const r=this.state.status==="pending",s=!k(this,Nr).canStart();try{if(r)n();else{U(this,zt,Cn).call(this,{type:"pending",variables:t,isPaused:s}),await((o=(i=k(this,Oe).config).onMutate)==null?void 0:o.call(i,t,this));const T=await((c=(l=this.options).onMutate)==null?void 0:c.call(l,t));T!==this.state.context&&U(this,zt,Cn).call(this,{type:"pending",context:T,variables:t,isPaused:s})}const P=await k(this,Nr).start();return await((d=(u=k(this,Oe).config).onSuccess)==null?void 0:d.call(u,P,t,this.state.context,this)),await((h=(f=this.options).onSuccess)==null?void 0:h.call(f,P,t,this.state.context)),await((w=(x=k(this,Oe).config).onSettled)==null?void 0:w.call(x,P,null,this.state.variables,this.state.context,this)),await((b=(v=this.options).onSettled)==null?void 0:b.call(v,P,null,t,this.state.context)),U(this,zt,Cn).call(this,{type:"success",data:P}),P}catch(P){try{throw await((g=(m=k(this,Oe).config).onError)==null?void 0:g.call(m,P,t,this.state.context,this)),await((j=(y=this.options).onError)==null?void 0:j.call(y,P,t,this.state.context)),await((N=(S=k(this,Oe).config).onSettled)==null?void 0:N.call(S,void 0,P,this.state.variables,this.state.context,this)),await((E=(C=this.options).onSettled)==null?void 0:E.call(C,void 0,P,t,this.state.context)),P}finally{U(this,zt,Cn).call(this,{type:"error",error:P})}}finally{k(this,Oe).runNext(this)}}},Vt=new WeakMap,Oe=new WeakMap,Nr=new WeakMap,zt=new WeakSet,Cn=function(t){const n=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),pe.batch(()=>{k(this,Vt).forEach(r=>{r.onMutationUpdate(t)}),k(this,Oe).notify({mutation:this,type:"updated",action:t})})},ry);function $x(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var tn,Et,ko,sy,pk=(sy=class extends ri{constructor(t={}){super();I(this,tn);I(this,Et);I(this,ko);this.config=t,M(this,tn,new Set),M(this,Et,new Map),M(this,ko,0)}build(t,n,r){const s=new hk({mutationCache:this,mutationId:++Bo(this,ko)._,options:t.defaultMutationOptions(n),state:r});return this.add(s),s}add(t){k(this,tn).add(t);const n=ia(t);if(typeof n=="string"){const r=k(this,Et).get(n);r?r.push(t):k(this,Et).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(k(this,tn).delete(t)){const n=ia(t);if(typeof n=="string"){const r=k(this,Et).get(n);if(r)if(r.length>1){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}else r[0]===t&&k(this,Et).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=ia(t);if(typeof n=="string"){const r=k(this,Et).get(n),s=r==null?void 0:r.find(i=>i.state.status==="pending");return!s||s===t}else return!0}runNext(t){var r;const n=ia(t);if(typeof n=="string"){const s=(r=k(this,Et).get(n))==null?void 0:r.find(i=>i!==t&&i.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){pe.batch(()=>{k(this,tn).forEach(t=>{this.notify({type:"removed",mutation:t})}),k(this,tn).clear(),k(this,Et).clear()})}getAll(){return Array.from(k(this,tn))}find(t){const n={exact:!0,...t};return this.getAll().find(r=>Zp(n,r))}findAll(t={}){return this.getAll().filter(n=>Zp(t,n))}notify(t){pe.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return pe.batch(()=>Promise.all(t.map(n=>n.continue().catch(Ve))))}},tn=new WeakMap,Et=new WeakMap,ko=new WeakMap,sy);function ia(e){var t;return(t=e.options.scope)==null?void 0:t.id}function tm(e){return{onFetch:(t,n)=>{var d,f,h,x,w;const r=t.options,s=(h=(f=(d=t.fetchOptions)==null?void 0:d.meta)==null?void 0:f.fetchMore)==null?void 0:h.direction,i=((x=t.state.data)==null?void 0:x.pages)||[],o=((w=t.state.data)==null?void 0:w.pageParams)||[];let l={pages:[],pageParams:[]},c=0;const u=async()=>{let v=!1;const b=y=>{Object.defineProperty(y,"signal",{enumerable:!0,get:()=>(t.signal.aborted?v=!0:t.signal.addEventListener("abort",()=>{v=!0}),t.signal)})},m=Ox(t.options,t.fetchOptions),g=async(y,j,S)=>{if(v)return Promise.reject();if(j==null&&y.pages.length)return Promise.resolve(y);const C=(()=>{const $={client:t.client,queryKey:t.queryKey,pageParam:j,direction:S?"backward":"forward",meta:t.options.meta};return b($),$})(),E=await m(C),{maxPages:P}=t.options,T=S?sk:rk;return{pages:T(y.pages,E,P),pageParams:T(y.pageParams,j,P)}};if(s&&i.length){const y=s==="backward",j=y?mk:nm,S={pages:i,pageParams:o},N=j(r,S);l=await g(S,N,y)}else{const y=e??i.length;do{const j=c===0?o[0]??r.initialPageParam:nm(r,l);if(c>0&&j==null)break;l=await g(l,j),c++}while(c<y)}return l};t.options.persister?t.fetchFn=()=>{var v,b;return(b=(v=t.options).persister)==null?void 0:b.call(v,u,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=u}}}function nm(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function mk(e,{pages:t,pageParams:n}){var r;return t.length>0?(r=e.getPreviousPageParam)==null?void 0:r.call(e,t[0],t,n[0],n):void 0}var ae,In,On,As,Rs,Fn,Ms,Ds,iy,gk=(iy=class{constructor(e={}){I(this,ae);I(this,In);I(this,On);I(this,As);I(this,Rs);I(this,Fn);I(this,Ms);I(this,Ds);M(this,ae,e.queryCache||new fk),M(this,In,e.mutationCache||new pk),M(this,On,e.defaultOptions||{}),M(this,As,new Map),M(this,Rs,new Map),M(this,Fn,0)}mount(){Bo(this,Fn)._++,k(this,Fn)===1&&(M(this,Ms,_f.subscribe(async e=>{e&&(await this.resumePausedMutations(),k(this,ae).onFocus())})),M(this,Ds,ul.subscribe(async e=>{e&&(await this.resumePausedMutations(),k(this,ae).onOnline())})))}unmount(){var e,t;Bo(this,Fn)._--,k(this,Fn)===0&&((e=k(this,Ms))==null||e.call(this),M(this,Ms,void 0),(t=k(this,Ds))==null||t.call(this),M(this,Ds,void 0))}isFetching(e){return k(this,ae).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return k(this,In).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=k(this,ae).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=k(this,ae).build(this,t),r=n.state.data;return r===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Jn(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return k(this,ae).findAll(e).map(({queryKey:t,state:n})=>{const r=n.data;return[t,r]})}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),s=k(this,ae).get(r.queryHash),i=s==null?void 0:s.state.data,o=tk(t,i);if(o!==void 0)return k(this,ae).build(this,r).setData(o,{...n,manual:!0})}setQueriesData(e,t,n){return pe.batch(()=>k(this,ae).findAll(e).map(({queryKey:r})=>[r,this.setQueryData(r,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=k(this,ae).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=k(this,ae);pe.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=k(this,ae);return pe.batch(()=>(n.findAll(e).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=pe.batch(()=>k(this,ae).findAll(e).map(s=>s.cancel(n)));return Promise.all(r).then(Ve).catch(Ve)}invalidateQueries(e,t={}){return pe.batch(()=>(k(this,ae).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=pe.batch(()=>k(this,ae).findAll(e).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let i=s.fetch(void 0,n);return n.throwOnError||(i=i.catch(Ve)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(r).then(Ve)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=k(this,ae).build(this,t);return n.isStaleByTime(Jn(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Ve).catch(Ve)}fetchInfiniteQuery(e){return e.behavior=tm(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Ve).catch(Ve)}ensureInfiniteQueryData(e){return e.behavior=tm(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return ul.isOnline()?k(this,In).resumePausedMutations():Promise.resolve()}getQueryCache(){return k(this,ae)}getMutationCache(){return k(this,In)}getDefaultOptions(){return k(this,On)}setDefaultOptions(e){M(this,On,e)}setQueryDefaults(e,t){k(this,As).set(_r(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...k(this,As).values()],n={};return t.forEach(r=>{fo(e,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(e,t){k(this,Rs).set(_r(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...k(this,Rs).values()],n={};return t.forEach(r=>{fo(e,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...k(this,On).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=Of(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Ff&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...k(this,On).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){k(this,ae).clear(),k(this,In).clear()}},ae=new WeakMap,In=new WeakMap,On=new WeakMap,As=new WeakMap,Rs=new WeakMap,Fn=new WeakMap,Ms=new WeakMap,Ds=new WeakMap,iy),He,W,So,Fe,Cr,Ls,_n,Vn,No,Is,Os,Er,Pr,zn,Fs,G,Pi,sd,id,od,ad,ld,cd,ud,Hx,oy,yk=(oy=class extends ri{constructor(t,n){super();I(this,G);I(this,He);I(this,W);I(this,So);I(this,Fe);I(this,Cr);I(this,Ls);I(this,_n);I(this,Vn);I(this,No);I(this,Is);I(this,Os);I(this,Er);I(this,Pr);I(this,zn);I(this,Fs,new Set);this.options=n,M(this,He,t),M(this,Vn,null),M(this,_n,rd()),this.options.experimental_prefetchInRender||k(this,_n).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(k(this,W).addObserver(this),rm(k(this,W),this.options)?U(this,G,Pi).call(this):this.updateResult(),U(this,G,ad).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return dd(k(this,W),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return dd(k(this,W),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,U(this,G,ld).call(this),U(this,G,cd).call(this),k(this,W).removeObserver(this)}setOptions(t){const n=this.options,r=k(this,W);if(this.options=k(this,He).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ht(this.options.enabled,k(this,W))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");U(this,G,ud).call(this),k(this,W).setOptions(this.options),n._defaulted&&!cl(this.options,n)&&k(this,He).getQueryCache().notify({type:"observerOptionsUpdated",query:k(this,W),observer:this});const s=this.hasListeners();s&&sm(k(this,W),r,this.options,n)&&U(this,G,Pi).call(this),this.updateResult(),s&&(k(this,W)!==r||ht(this.options.enabled,k(this,W))!==ht(n.enabled,k(this,W))||Jn(this.options.staleTime,k(this,W))!==Jn(n.staleTime,k(this,W)))&&U(this,G,sd).call(this);const i=U(this,G,id).call(this);s&&(k(this,W)!==r||ht(this.options.enabled,k(this,W))!==ht(n.enabled,k(this,W))||i!==k(this,zn))&&U(this,G,od).call(this,i)}getOptimisticResult(t){const n=k(this,He).getQueryCache().build(k(this,He),t),r=this.createResult(n,t);return vk(this,r)&&(M(this,Fe,r),M(this,Ls,this.options),M(this,Cr,k(this,W).state)),r}getCurrentResult(){return k(this,Fe)}trackResult(t,n){return new Proxy(t,{get:(r,s)=>(this.trackProp(s),n==null||n(s),Reflect.get(r,s))})}trackProp(t){k(this,Fs).add(t)}getCurrentQuery(){return k(this,W)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const n=k(this,He).defaultQueryOptions(t),r=k(this,He).getQueryCache().build(k(this,He),n);return r.fetch().then(()=>this.createResult(r,n))}fetch(t){return U(this,G,Pi).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),k(this,Fe)))}createResult(t,n){var P;const r=k(this,W),s=this.options,i=k(this,Fe),o=k(this,Cr),l=k(this,Ls),u=t!==r?t.state:k(this,So),{state:d}=t;let f={...d},h=!1,x;if(n._optimisticResults){const T=this.hasListeners(),$=!T&&rm(t,n),V=T&&sm(t,r,n,s);($||V)&&(f={...f,...Ux(d.data,t.options)}),n._optimisticResults==="isRestoring"&&(f.fetchStatus="idle")}let{error:w,errorUpdatedAt:v,status:b}=f;x=f.data;let m=!1;if(n.placeholderData!==void 0&&x===void 0&&b==="pending"){let T;i!=null&&i.isPlaceholderData&&n.placeholderData===(l==null?void 0:l.placeholderData)?(T=i.data,m=!0):T=typeof n.placeholderData=="function"?n.placeholderData((P=k(this,Os))==null?void 0:P.state.data,k(this,Os)):n.placeholderData,T!==void 0&&(b="success",x=nd(i==null?void 0:i.data,T,n),h=!0)}if(n.select&&x!==void 0&&!m)if(i&&x===(o==null?void 0:o.data)&&n.select===k(this,No))x=k(this,Is);else try{M(this,No,n.select),x=n.select(x),x=nd(i==null?void 0:i.data,x,n),M(this,Is,x),M(this,Vn,null)}catch(T){M(this,Vn,T)}k(this,Vn)&&(w=k(this,Vn),x=k(this,Is),v=Date.now(),b="error");const g=f.fetchStatus==="fetching",y=b==="pending",j=b==="error",S=y&&g,N=x!==void 0,E={status:b,fetchStatus:f.fetchStatus,isPending:y,isSuccess:b==="success",isError:j,isInitialLoading:S,isLoading:S,data:x,dataUpdatedAt:f.dataUpdatedAt,error:w,errorUpdatedAt:v,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>u.dataUpdateCount||f.errorUpdateCount>u.errorUpdateCount,isFetching:g,isRefetching:g&&!y,isLoadingError:j&&!N,isPaused:f.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:j&&N,isStale:Vf(t,n),refetch:this.refetch,promise:k(this,_n),isEnabled:ht(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const T=ge=>{E.status==="error"?ge.reject(E.error):E.data!==void 0&&ge.resolve(E.data)},$=()=>{const ge=M(this,_n,E.promise=rd());T(ge)},V=k(this,_n);switch(V.status){case"pending":t.queryHash===r.queryHash&&T(V);break;case"fulfilled":(E.status==="error"||E.data!==V.value)&&$();break;case"rejected":(E.status!=="error"||E.error!==V.reason)&&$();break}}return E}updateResult(){const t=k(this,Fe),n=this.createResult(k(this,W),this.options);if(M(this,Cr,k(this,W).state),M(this,Ls,this.options),k(this,Cr).data!==void 0&&M(this,Os,k(this,W)),cl(n,t))return;M(this,Fe,n);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:s}=this.options,i=typeof s=="function"?s():s;if(i==="all"||!i&&!k(this,Fs).size)return!0;const o=new Set(i??k(this,Fs));return this.options.throwOnError&&o.add("error"),Object.keys(k(this,Fe)).some(l=>{const c=l;return k(this,Fe)[c]!==t[c]&&o.has(c)})};U(this,G,Hx).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&U(this,G,ad).call(this)}},He=new WeakMap,W=new WeakMap,So=new WeakMap,Fe=new WeakMap,Cr=new WeakMap,Ls=new WeakMap,_n=new WeakMap,Vn=new WeakMap,No=new WeakMap,Is=new WeakMap,Os=new WeakMap,Er=new WeakMap,Pr=new WeakMap,zn=new WeakMap,Fs=new WeakMap,G=new WeakSet,Pi=function(t){U(this,G,ud).call(this);let n=k(this,W).fetch(this.options,t);return t!=null&&t.throwOnError||(n=n.catch(Ve)),n},sd=function(){U(this,G,ld).call(this);const t=Jn(this.options.staleTime,k(this,W));if(Fr||k(this,Fe).isStale||!ed(t))return;const r=Lx(k(this,Fe).dataUpdatedAt,t)+1;M(this,Er,setTimeout(()=>{k(this,Fe).isStale||this.updateResult()},r))},id=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(k(this,W)):this.options.refetchInterval)??!1},od=function(t){U(this,G,cd).call(this),M(this,zn,t),!(Fr||ht(this.options.enabled,k(this,W))===!1||!ed(k(this,zn))||k(this,zn)===0)&&M(this,Pr,setInterval(()=>{(this.options.refetchIntervalInBackground||_f.isFocused())&&U(this,G,Pi).call(this)},k(this,zn)))},ad=function(){U(this,G,sd).call(this),U(this,G,od).call(this,U(this,G,id).call(this))},ld=function(){k(this,Er)&&(clearTimeout(k(this,Er)),M(this,Er,void 0))},cd=function(){k(this,Pr)&&(clearInterval(k(this,Pr)),M(this,Pr,void 0))},ud=function(){const t=k(this,He).getQueryCache().build(k(this,He),this.options);if(t===k(this,W))return;const n=k(this,W);M(this,W,t),M(this,So,t.state),this.hasListeners()&&(n==null||n.removeObserver(this),t.addObserver(this))},Hx=function(t){pe.batch(()=>{t.listeners&&this.listeners.forEach(n=>{n(k(this,Fe))}),k(this,He).getQueryCache().notify({query:k(this,W),type:"observerResultsUpdated"})})},oy);function xk(e,t){return ht(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function rm(e,t){return xk(e,t)||e.state.data!==void 0&&dd(e,t,t.refetchOnMount)}function dd(e,t,n){if(ht(t.enabled,e)!==!1&&Jn(t.staleTime,e)!=="static"){const r=typeof n=="function"?n(e):n;return r==="always"||r!==!1&&Vf(e,t)}return!1}function sm(e,t,n,r){return(e!==t||ht(r.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&Vf(e,n)}function Vf(e,t){return ht(t.enabled,e)!==!1&&e.isStaleByTime(Jn(t.staleTime,e))}function vk(e,t){return!cl(e.getCurrentResult(),t)}var Bn,Un,We,nn,dn,Ra,fd,ay,wk=(ay=class extends ri{constructor(n,r){super();I(this,dn);I(this,Bn);I(this,Un);I(this,We);I(this,nn);M(this,Bn,n),this.setOptions(r),this.bindMethods(),U(this,dn,Ra).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var s;const r=this.options;this.options=k(this,Bn).defaultMutationOptions(n),cl(this.options,r)||k(this,Bn).getMutationCache().notify({type:"observerOptionsUpdated",mutation:k(this,We),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&_r(r.mutationKey)!==_r(this.options.mutationKey)?this.reset():((s=k(this,We))==null?void 0:s.state.status)==="pending"&&k(this,We).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=k(this,We))==null||n.removeObserver(this)}onMutationUpdate(n){U(this,dn,Ra).call(this),U(this,dn,fd).call(this,n)}getCurrentResult(){return k(this,Un)}reset(){var n;(n=k(this,We))==null||n.removeObserver(this),M(this,We,void 0),U(this,dn,Ra).call(this),U(this,dn,fd).call(this)}mutate(n,r){var s;return M(this,nn,r),(s=k(this,We))==null||s.removeObserver(this),M(this,We,k(this,Bn).getMutationCache().build(k(this,Bn),this.options)),k(this,We).addObserver(this),k(this,We).execute(n)}},Bn=new WeakMap,Un=new WeakMap,We=new WeakMap,nn=new WeakMap,dn=new WeakSet,Ra=function(){var r;const n=((r=k(this,We))==null?void 0:r.state)??$x();M(this,Un,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},fd=function(n){pe.batch(()=>{var r,s,i,o,l,c,u,d;if(k(this,nn)&&this.hasListeners()){const f=k(this,Un).variables,h=k(this,Un).context;(n==null?void 0:n.type)==="success"?((s=(r=k(this,nn)).onSuccess)==null||s.call(r,n.data,f,h),(o=(i=k(this,nn)).onSettled)==null||o.call(i,n.data,null,f,h)):(n==null?void 0:n.type)==="error"&&((c=(l=k(this,nn)).onError)==null||c.call(l,n.error,f,h),(d=(u=k(this,nn)).onSettled)==null||d.call(u,void 0,n.error,f,h))}this.listeners.forEach(f=>{f(k(this,Un))})})},ay),Wx=p.createContext(void 0),$r=e=>{const t=p.useContext(Wx);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},bk=({client:e,children:t})=>(p.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),a.jsx(Wx.Provider,{value:e,children:t})),Kx=p.createContext(!1),jk=()=>p.useContext(Kx);Kx.Provider;function kk(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Sk=p.createContext(kk()),Nk=()=>p.useContext(Sk),Ck=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Ek=e=>{p.useEffect(()=>{e.clearReset()},[e])},Pk=({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(s&&e.data===void 0||Fx(n,[e.error,r])),Tk=e=>{if(e.suspense){const t=r=>r==="static"?r:Math.max(r??1e3,1e3),n=e.staleTime;e.staleTime=typeof n=="function"?(...r)=>t(n(...r)):t(n),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Ak=(e,t)=>e.isLoading&&e.isFetching&&!t,Rk=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,im=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function Mk(e,t,n){var f,h,x,w,v;const r=jk(),s=Nk(),i=$r(),o=i.defaultQueryOptions(e);(h=(f=i.getDefaultOptions().queries)==null?void 0:f._experimental_beforeQuery)==null||h.call(f,o),o._optimisticResults=r?"isRestoring":"optimistic",Tk(o),Ck(o,s),Ek(s);const l=!i.getQueryCache().get(o.queryHash),[c]=p.useState(()=>new t(i,o)),u=c.getOptimisticResult(o),d=!r&&e.subscribed!==!1;if(p.useSyncExternalStore(p.useCallback(b=>{const m=d?c.subscribe(pe.batchCalls(b)):Ve;return c.updateResult(),m},[c,d]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),p.useEffect(()=>{c.setOptions(o)},[o,c]),Rk(o,u))throw im(o,c,s);if(Pk({result:u,errorResetBoundary:s,throwOnError:o.throwOnError,query:i.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw u.error;if((w=(x=i.getDefaultOptions().queries)==null?void 0:x._experimental_afterQuery)==null||w.call(x,o,u),o.experimental_prefetchInRender&&!Fr&&Ak(u,r)){const b=l?im(o,c,s):(v=i.getQueryCache().get(o.queryHash))==null?void 0:v.promise;b==null||b.catch(Ve).finally(()=>{c.updateResult()})}return o.notifyOnChangeProps?u:c.trackResult(u)}function Lt(e,t){return Mk(e,yk)}function wt(e,t){const n=$r(),[r]=p.useState(()=>new wk(n,e));p.useEffect(()=>{r.setOptions(e)},[r,e]);const s=p.useSyncExternalStore(p.useCallback(o=>r.subscribe(pe.batchCalls(o)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),i=p.useCallback((o,l)=>{r.mutate(o,l).catch(Ve)},[r]);if(s.error&&Fx(r.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:i,mutateAsync:s.mutate}}const Dc={},Dk=typeof import.meta<"u"&&(Dc==null?void 0:Dc.VITE_API_BASE)||"/api";function Lk(){try{return localStorage.getItem("sb-access-token")||"dev-mock-token"}catch{return"dev-mock-token"}}function Ik(e){if(!e)return"";const t=new URLSearchParams;Object.entries(e).forEach(([r,s])=>{s!=null&&t.set(r,String(s))});const n=t.toString();return n?`?${n}`:""}async function oa(e,t,n,r){const s=`${Dk}${t}`,i=new Headers(r||{}),o=Lk();o&&i.set("Authorization",`Bearer ${o}`);const l={method:e,headers:i};n instanceof FormData?l.body=n:n!==void 0&&(i.has("Content-Type")||i.set("Content-Type","application/json"),l.body=JSON.stringify(n));const c=await fetch(s,l);if(!c.ok){const d=await c.text().catch(()=>"");throw new Error(`HTTP ${c.status} ${c.statusText}: ${d}`)}return c.status===204?void 0:(c.headers.get("content-type")||"").includes("application/json")?c.json():await c.text()}const lt={get:(e,t,n)=>oa("GET",`${e}${Ik(t)}`,void 0,n),post:(e,t,n)=>oa("POST",e,t,n),patch:(e,t,n)=>oa("PATCH",e,t,n),del:(e,t,n)=>oa("DELETE",e,t,n)},Qx=p.createContext(null);function Ok(){try{return localStorage.getItem("sb-access-token")}catch{return null}}function Fk({children:e}){const[t,n]=p.useState(!1),[r,s]=p.useState(()=>{const d=Ok();return d!==null?!!d:!0}),i=p.useCallback(()=>{window.location.href="/api/auth/google/start"},[]),o=p.useCallback(()=>"/api/auth/google/start",[]),l=p.useCallback(async()=>{n(!0);try{try{await lt.post("/api/auth/logout")}catch{}localStorage.removeItem("sb-access-token"),s(!1),location.assign("/")}finally{n(!1)}},[]),c=r?{id:"user_1",email:"admin@contentrad.com",name:"Content Radar Admin",avatar_url:void 0}:null,u=p.useMemo(()=>({user:c,loading:!1,isAuthenticated:r,isSigningOut:t,getSignInUrl:o,signIn:i,signOut:l}),[c,r,t,o,i,l]);return rn.createElement(Qx.Provider,{value:u},e)}function zf(){const e=p.useContext(Qx);if(!e)throw new Error("useAuth must be used within AuthProvider");return e}const _k=new gk({defaultOptions:{queries:{staleTime:3e4,refetchOnWindowFocus:!1}}}),Gx=p.createContext(void 0);function Ro(){const e=p.useContext(Gx);if(e===void 0)throw new Error("useProjectContext must be used within a ProjectProvider");return e}function Vk({children:e}){const[t,n]=p.useState(null);return a.jsx(Gx.Provider,{value:{currentProjectId:t,setCurrentProjectId:n},children:e})}function zk({children:e}){return p.useEffect(()=>{const t=document.documentElement,n=document.body,s=localStorage.getItem("theme")||"dark";t.classList.remove("theme-dark","theme-light"),t.classList.add(s==="light"?"theme-light":"theme-dark"),n.classList.add("bg-app","text-ink"),n.style.minHeight="100vh",n.style.margin="0",n.style.padding="0"},[]),a.jsx(a.Fragment,{children:e})}function Bk({children:e}){return a.jsx(bk,{client:_k,children:a.jsx(zk,{children:a.jsx(Vk,{children:a.jsx(Fk,{children:e})})})})}const Bf=p.createContext({});function Hr(e){const t=p.useRef(null);return t.current===null&&(t.current=e()),t.current}const zl=p.createContext(null),Bl=p.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Uk extends p.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function $k({children:e,isPresent:t}){const n=p.useId(),r=p.useRef(null),s=p.useRef({width:0,height:0,top:0,left:0}),{nonce:i}=p.useContext(Bl);return p.useInsertionEffect(()=>{const{width:o,height:l,top:c,left:u}=s.current;if(t||!r.current||!o||!l)return;r.current.dataset.motionPopId=n;const d=document.createElement("style");return i&&(d.nonce=i),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
server/scripts/verify-live.ts:44:    const viteMock = process.env.MOCK_AUTH ?? "(not set in server env)";
server/scripts/verify-live.ts:58:      details: `MOCK_AUTH=${viteMock}`,
- Wildcard CORS or permissive origins:
  (not found)
- CSP/CORS headers mentions:
server/lib/cache.ts:21:      // Generate ETag from response body
server/lib/cache.ts:26:      // Set ETag header
server/lib/cache.ts:27:      res.setHeader('ETag', etag);
server/lib/cache.ts:29:      // Set Cache-Control header
server/lib/cache.ts:32:      res.setHeader('Cache-Control', `${cacheControl}, max-age=${maxAge}`);
server/lib/sse.ts:5:  res.setHeader('Cache-Control', 'no-cache, no-transform');
server/public/index.html:6:    <meta http-equiv="Content-Security-Policy" content="default-src 'self' blob: data: https: ws: wss:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: blob: https:; font-src 'self' https://fonts.gstatic.com data:; connect-src 'self' https: ws: wss:; frame-src *;">
server/routes/captures.ts:39:    // Implement ETag and Last-Modified caching
server/routes/captures.ts:47:    res.set('ETag', etag);
server/routes/captures.ts:50:    const clientETag = req.headers['if-none-match'];
server/routes/captures.ts:53:    if (clientETag && clientETag === etag) {
server/security/chromeExtensionSecurity.ts:152:    res.header('Content-Security-Policy', [

## API Surface & Routes (static grep)

  server/index.ts:189:  app.get("/api/debug/logs", async (req, res) => {
  server/index.ts:211:  app.get("/api/debug/errors", async (req, res) => {
  server/index.ts:227:  app.get("/api/debug/performance", async (req, res) => {
  server/index.ts:245:  app.get("/api/system/metrics", async (req, res) => {
  server/index.ts:262:  app.get("/api/system/requests", async (req, res) => {
  server/routes.ts:201:  app.post("/api/public/ai-analysis", async (req, res) => {
  server/routes.ts:235:  app.post("/api/public/truth-analysis", async (req, res) => {
  server/routes.ts:268:  app.post("/api/public/bright-data-test", async (req, res) => {
  server/routes.ts:296:  app.post("/api/bright-data/trigger", async (req, res) => {
  server/routes.ts:368:  app.get("/api/jobs/:id", requireAuth, async (req: AuthedRequest, res) => {
  server/routes.ts:385:  app.post("/api/truth-analysis", async (req, res) => {
  server/routes.ts:441:  app.get("/api/stats", async (req, res) => {
  server/routes.ts:451:  app.get("/api/signals/cultural", async (req, res) => {
  server/routes.ts:483:  app.get("/api/opportunities/realtime", async (req, res) => {
  server/routes.ts:520:  app.get("/api/content", async (req, res) => {
  server/routes.ts:614:  app.get("/api/content/:id", async (req, res) => {
  server/routes.ts:627:  app.post("/api/content", async (req, res) => {
  server/routes.ts:643:  app.patch("/api/content/:id", async (req, res) => {
  server/routes.ts:657:  app.delete("/api/content/:id", async (req, res) => {
  server/routes.ts:667:  app.post("/api/scan", async (req, res) => {
  server/routes.ts:677:  app.post("/api/brightdata/populate-sample", async (req, res) => {
  server/routes.ts:803:  app.post("/api/analysis/content", async (req, res) => {
  server/routes.ts:827:  app.get("/api/analysis/captured/:captureId", async (req, res) => {
  server/routes.ts:854:  app.post("/api/scraping/test", async (req, res) => {
  server/routes.ts:873:  app.post("/api/scraping/browser-test", async (req, res) => {
  server/routes.ts:901:  app.get("/api/google/test-connection", async (req, res) => {
  server/routes.ts:928:  app.post("/api/brightdata/test", async (req, res) => {
  server/routes.ts:993:  app.post("/api/brightdata/browser/test", async (req, res) => {
  server/routes.ts:1041:  app.get("/api/scans", async (req, res) => {
  server/routes.ts:1052:  app.post("/api/content/:id/hooks", async (req, res) => {
  server/routes.ts:1075:  app.get("/api/export", async (req, res) => {
  server/routes.ts:1102:  app.post("/api/capture", async (req, res) => {
  server/routes.ts:1119:  app.post("/api/content/scan", async (req, res) => {
  server/routes.ts:1141:  app.post("/api/system/test-all", async (req, res) => {
  server/routes.ts:1169:  app.get("/api/system/health", async (req, res) => {
  server/routes.ts:1202:  app.get("/api/system/errors", async (req, res) => {
  server/routes.ts:1214:  app.post("/api/system/errors", async (req, res) => {
  server/routes.ts:1258:  app.patch("/api/system/errors/:id", async (req, res) => {
  server/routes.ts:1300:  app.post("/api/schedule/start", async (req, res) => {
  server/routes.ts:1307:  app.post("/api/schedule/stop", async (req, res) => {
  server/routes.ts:1314:  app.get("/api/schedule/status", async (req, res) => {
  server/routes.ts:1319:  app.get("/api/search", async (req, res) => {
  server/routes.ts:1345:  app.get("/api/sources", async (req, res) => {
  server/routes.ts:1355:  app.get("/api/signals", async (req, res) => {
  server/routes.ts:1385:  app.get("/api/tier2/sources", async (req, res) => {
  server/routes.ts:1395:  app.post("/api/tier2/fetch", async (req, res) => {
  server/routes.ts:1460:  app.get("/api/briefs/templates", async (req, res) => {
  server/routes.ts:1470:  app.post("/api/briefs/generate", async (req, res) => {
  server/routes.ts:1505:  app.post("/api/intelligence/comprehensive", async (req, res) => {
  server/routes.ts:1594:  app.post("/api/chrome-extension/capture", async (req, res) => {
  server/routes.ts:1620:  app.post("/api/chrome-extension/batch", async (req, res) => {
  server/routes.ts:1645:  app.get("/api/chrome-extension/stats", async (req, res) => {
  server/routes.ts:1657:  app.get("/api/client-profiles", async (req, res) => {
  server/routes.ts:1671:  app.get("/api/client-profiles/:id", async (req, res) => {
  server/routes.ts:1689:  app.post("/api/client-profiles", async (req, res) => {
  server/routes.ts:1707:  app.patch("/api/client-profiles/:id", async (req, res) => {
  server/routes.ts:1724:  app.delete("/api/client-profiles/:id", async (req, res) => {
  server/routes.ts:1739:  app.get("/api/dsd-briefs", async (req, res) => {
  server/routes.ts:1758:  app.get("/api/dsd-briefs/:id", async (req, res) => {
  server/routes.ts:1776:  app.post("/api/dsd-briefs", async (req, res) => {
  server/routes.ts:1790:  app.patch("/api/dsd-briefs/:id", async (req, res) => {
  server/routes.ts:1804:  app.delete("/api/dsd-briefs/:id", async (req, res) => {
  server/routes.ts:1819:  app.get("/api/collective-patterns", async (req, res) => {
  server/routes.ts:1837:  app.post("/api/collective-patterns", async (req, res) => {
  server/routes.ts:1852:  app.get("/api/cultural-moments", async (req, res) => {
  server/routes.ts:1868:  app.post("/api/cultural-moments", async (req, res) => {
  server/routes.ts:1882:  app.patch("/api/cultural-moments/:id", async (req, res) => {
  server/routes.ts:1961:  app.get("/api/analytics/content-trends", async (req, res) => {
  server/routes.ts:2015:  app.get("/api/analytics/viral-patterns", async (req, res) => {
  server/routes.ts:2157:  app.get("/api/hypothesis-validations", async (req, res) => {
  server/routes.ts:2171:  app.post("/api/hypothesis-validations", async (req, res) => {
  server/routes.ts:2201:  app.patch("/api/hypothesis-validations/:id", async (req, res) => {
  server/routes.ts:2221:  app.get("/api/system/status", async (req, res) => {
  server/routes.ts:2269:  app.get("/api/bright-data/test", async (req, res) => {
  server/routes.ts:2283:  app.get("/api/bright-data/status", async (req, res) => {
  server/routes.ts:2293:  app.get("/api/bright-data/instructions", async (req, res) => {
  server/routes.ts:2303:  app.post("/api/bright-data/config", async (req, res) => {
  server/routes.ts:2328:  app.post("/api/auth/register", async (req, res) => {
  server/routes.ts:2371:  app.post("/api/auth/login", async (req, res) => {
  server/routes.ts:2414:  app.post("/api/auth/logout", async (req, res) => {
  server/routes.ts:2424:  app.get("/api/auth/me", async (req, res) => {
  server/routes/analytics.ts:15:  app.get('/api/analytics/dashboard', async (req, res) => {
  server/routes/analytics.ts:30:  app.get('/api/analytics', async (req, res) => {
  server/routes/analytics.ts:58:  app.get('/api/analytics/trends', async (req, res) => {
  server/routes/analytics.ts:100:  app.post('/api/analytics', async (req, res) => {
  server/routes/analytics.ts:130:  app.get('/api/analytics/platforms', async (req, res) => {
  server/routes/analytics.ts:159:  app.get('/api/analytics/projects/compare', async (req, res) => {
  server/routes/annotations.ts:27:  app.get('/api/captures/:captureId/annotations', async (req, res) => {
  server/routes/annotations.ts:51:  app.get('/api/annotations/:id', async (req, res) => {
  server/routes/annotations.ts:80:  app.post('/api/annotations', async (req, res) => {
  server/routes/annotations.ts:115:  app.patch('/api/annotations/:id', async (req, res) => {
  server/routes/annotations.ts:141:  app.delete('/api/annotations/:id', async (req, res) => {
  server/routes/annotations.ts:167:  app.post('/api/annotations/:id/share', async (req, res) => {
  server/routes/auth.ts:42:  app.get('/api/auth/me', async (req: Request, res: Response) => {
  server/routes/auth.ts:53:  app.get('/api/auth/user', async (req: Request, res: Response) => {
  server/routes/auth.ts:64:  app.post('/api/auth/register', async (req: Request, res: Response) => {
  server/routes/auth.ts:107:  app.post('/api/auth/login', async (req: Request, res: Response) => {
  server/routes/auth.ts:147:  app.post('/api/auth/logout', async (req: Request, res: Response) => {
  server/routes/auth.ts:159:  app.get('/api/auth/google/start', async (req: Request, res: Response) => {
  server/routes/daily.ts:13:  app.get("/api/daily-briefing", async (req, res) => {
  server/routes/export-jobs.ts:17:  app.post('/api/briefs/:id/export', async (req: Request, res: Response) => {
  server/routes/export-jobs.ts:71:  app.get('/api/jobs/:jobId', async (req: Request, res: Response) => {
  server/routes/google-export.ts:31:  app.post("/api/briefs/:id/export/slides", requireAuth, async (req: AuthedRequest, res) => {
  server/routes/google-export.ts:135:  app.get("/api/auth/google", requireAuth, async (req: AuthedRequest, res) => {
  server/routes/google-export.ts:149:  app.get("/api/auth/google/callback", requireAuth, async (req: AuthedRequest, res) => {
  server/routes/projects.ts:10:  app.get('/api/projects', requireAuth, async (req: AuthedRequest, res: Response) => {
  server/routes/projects.ts:25:  app.post('/api/projects', requireAuth, async (req: AuthedRequest, res: Response) => {
  server/routes/projects.ts:48:  app.patch('/api/projects/:id', requireAuth, async (req: AuthedRequest, res: Response) => {
  server/routes/projects.ts:72:  app.delete('/api/projects/:id', requireAuth, async (req: AuthedRequest, res: Response) => {
  server/routes/settings.ts:33:  app.get('/api/settings', async (req, res) => {
  server/routes/settings.ts:75:  app.put('/api/settings', async (req, res) => {
  server/routes/settings.ts:108:  app.patch('/api/settings/:category', async (req, res) => {
  server/routes/truth.ts:16:  app.post('/api/truth/extract', async (req: Request, res: Response) => {
  server/routes/truth.ts:45:  app.post('/api/truth/analyze-text/:id', async (req: Request, res: Response) => {
  server/routes/truth.ts:100:  app.get('/api/truth/:id', async (req: Request, res: Response) => {
- Captures router mounted:
server/routes.ts:150:  app.use("/api/captures", capturesRouter);
server/routes.ts:436:  app.use("/api/captures", captureAnalysisRouter);
- Daily briefing route:
client/src/ui-v2/services/daily.ts:11:  return api.get<DailyBriefing>("/daily-briefing");
server/routes/daily.ts:13:  app.get("/api/daily-briefing", async (req, res) => {
server/routes/daily.ts:69:      console.error("daily-briefing error:", err);
server/routes/daily.ts:70:      return res.status(500).json({ error: "daily-briefing failed" });
- Truth Lab routes:
server/public/assets/index-B7xfy0OJ.js:461:Please change the parent <Route path="${m}"> to <Route path="${m==="/"?"*":`${m}/*`}">.`)}let f=Gr(),h;h=f;let x=h.pathname||"/",w=x;if(u!=="/"){let m=u.replace(/^\//,"").split("/");w="/"+x.replace(/^\//,"").split("/").slice(m.length).join("/")}let v=Lw(e,{pathname:w});return xn(d||v!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),xn(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),_A(v&&v.map(m=>Object.assign({},m,{params:Object.assign({},l,m.params),pathname:un([u,s.encodeLocation?s.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?u:un([u,s.encodeLocation?s.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),i,n,r)}function LA(){let e=$A(),t=NA(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",e),o=p.createElement(p.Fragment,null,p.createElement("p",null," Hey developer "),p.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",p.createElement("code",{style:i},"ErrorBoundary")," or"," ",p.createElement("code",{style:i},"errorElement")," prop on your route.")),p.createElement(p.Fragment,null,p.createElement("h2",null,"Unexpected Application Error!"),p.createElement("h3",{style:{fontStyle:"italic"}},t),n?p.createElement("pre",{style:s},n):null,o)}var IA=p.createElement(LA,null),OA=class extends p.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?p.createElement(qt.Provider,{value:this.props.routeContext},p.createElement(Rh.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function FA({routeContext:e,match:t,children:n}){let r=p.useContext(ci);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),p.createElement(qt.Provider,{value:e},n)}function _A(e,t=[],n=null,r=null){if(e==null){if(!n)return null;if(n.errors)e=n.matches;else if(t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let s=e,i=n==null?void 0:n.errors;if(i!=null){let c=s.findIndex(u=>u.route.id&&(i==null?void 0:i[u.route.id])!==void 0);Pe(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),s=s.slice(0,Math.min(s.length,c+1))}let o=!1,l=-1;if(n)for(let c=0;c<s.length;c++){let u=s[c];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(l=c),u.route.id){let{loaderData:d,errors:f}=n,h=u.route.loader&&!d.hasOwnProperty(u.route.id)&&(!f||f[u.route.id]===void 0);if(u.route.lazy||h){o=!0,l>=0?s=s.slice(0,l+1):s=[s[0]];break}}}return s.reduceRight((c,u,d)=>{let f,h=!1,x=null,w=null;n&&(f=i&&u.route.id?i[u.route.id]:void 0,x=u.route.errorElement||IA,o&&(l<0&&d===0?($w("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,w=null):l===d&&(h=!0,w=u.route.hydrateFallbackElement||null)));let v=t.concat(s.slice(0,d+1)),b=()=>{let m;return f?m=x:h?m=w:u.route.Component?m=p.createElement(u.route.Component,null):u.route.element?m=u.route.element:m=c,p.createElement(FA,{match:u,routeContext:{outlet:c,matches:v,isDataRoute:n!=null},children:m})};return n&&(u.route.ErrorBoundary||u.route.errorElement||d===0)?p.createElement(OA,{location:n.location,revalidation:n.revalidation,component:x,error:f,children:b(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):b()},null)}function Mh(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function VA(e){let t=p.useContext(ci);return Pe(t,Mh(e)),t}function zA(e){let t=p.useContext(ec);return Pe(t,Mh(e)),t}function BA(e){let t=p.useContext(qt);return Pe(t,Mh(e)),t}function Dh(e){let t=BA(e),n=t.matches[t.matches.length-1];return Pe(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function UA(){return Dh("useRouteId")}function $A(){var r;let e=p.useContext(Rh),t=zA("useRouteError"),n=Dh("useRouteError");return e!==void 0?e:(r=t.errors)==null?void 0:r[n]}function HA(){let{router:e}=VA("useNavigate"),t=Dh("useNavigate"),n=p.useRef(!1);return Uw(()=>{n.current=!0}),p.useCallback(async(s,i={})=>{xn(n.current,Bw),n.current&&(typeof s=="number"?e.navigate(s):await e.navigate(s,{fromRouteId:t,...i}))},[e,t])}var Kg={};function $w(e,t,n){!t&&!Kg[e]&&(Kg[e]=!0,xn(!1,n))}p.memo(WA);function WA({routes:e,future:t,state:n}){return DA(e,void 0,n,t)}var Fa="get",_a="application/x-www-form-urlencoded";function nc(e){return e!=null&&typeof e.tagName=="string"}function KA(e){return nc(e)&&e.tagName.toLowerCase()==="button"}function QA(e){return nc(e)&&e.tagName.toLowerCase()==="form"}function GA(e){return nc(e)&&e.tagName.toLowerCase()==="input"}function qA(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function YA(e,t){return e.button===0&&(!t||t==="_self")&&!qA(e)}var ya=null;function XA(){if(ya===null)try{new FormData(document.createElement("form"),0),ya=!1}catch{ya=!0}return ya}var ZA=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ou(e){return e!=null&&!ZA.has(e)?(xn(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${_a}"`),null):e}function JA(e,t){let n,r,s,i,o;if(QA(e)){let l=e.getAttribute("action");r=l?ir(l,t):null,n=e.getAttribute("method")||Fa,s=ou(e.getAttribute("enctype"))||_a,i=new FormData(e)}else if(KA(e)||GA(e)&&(e.type==="submit"||e.type==="image")){let l=e.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=e.getAttribute("formaction")||l.getAttribute("action");if(r=c?ir(c,t):null,n=e.getAttribute("formmethod")||l.getAttribute("method")||Fa,s=ou(e.getAttribute("formenctype"))||ou(l.getAttribute("enctype"))||_a,i=new FormData(l,e),!XA()){let{name:u,type:d,value:f}=e;if(d==="image"){let h=u?`${u}.`:"";i.append(`${h}x`,"0"),i.append(`${h}y`,"0")}else u&&i.append(u,f)}}else{if(nc(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Fa,r=null,s=_a,o=e}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Lh(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function eR(e,t,n){let r=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return r.pathname==="/"?r.pathname=`_root.${n}`:t&&ir(r.pathname,t)==="/"?r.pathname=`${t.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function tR(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function nR(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function rR(e,t,n){let r=await Promise.all(e.map(async s=>{let i=t.routes[s.route.id];if(i){let o=await tR(i,n);return o.links?o.links():[]}return[]}));return aR(r.flat(1).filter(nR).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Qg(e,t,n,r,s,i){let o=(c,u)=>n[u]?c.route.id!==n[u].route.id:!0,l=(c,u)=>{var d;return n[u].pathname!==c.pathname||((d=n[u].route.path)==null?void 0:d.endsWith("*"))&&n[u].params["*"]!==c.params["*"]};return i==="assets"?t.filter((c,u)=>o(c,u)||l(c,u)):i==="data"?t.filter((c,u)=>{var f;let d=r.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(o(c,u)||l(c,u))return!0;if(c.route.shouldRevalidate){let h=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(e,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function sR(e,t,{includeHydrateFallback:n}={}){return iR(e.map(r=>{let s=t.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function iR(e){return[...new Set(e)]}function oR(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}function aR(e,t){let n=new Set;return new Set(t),e.reduce((r,s)=>{let i=JSON.stringify(oR(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function Hw(){let e=p.useContext(ci);return Lh(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function lR(){let e=p.useContext(ec);return Lh(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var Ih=p.createContext(void 0);Ih.displayName="FrameworkContext";function Ww(){let e=p.useContext(Ih);return Lh(e,"You must render this element inside a <HydratedRouter> element"),e}function cR(e,t){let n=p.useContext(Ih),[r,s]=p.useState(!1),[i,o]=p.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:u,onMouseLeave:d,onTouchStart:f}=t,h=p.useRef(null);p.useEffect(()=>{if(e==="render"&&o(!0),e==="viewport"){let v=m=>{m.forEach(g=>{o(g.isIntersecting)})},b=new IntersectionObserver(v,{threshold:.5});return h.current&&b.observe(h.current),()=>{b.disconnect()}}},[e]),p.useEffect(()=>{if(r){let v=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(v)}}},[r]);let x=()=>{s(!0)},w=()=>{s(!1),o(!1)};return n?e!=="intent"?[i,h,{}]:[i,h,{onFocus:ji(l,x),onBlur:ji(c,w),onMouseEnter:ji(u,x),onMouseLeave:ji(d,w),onTouchStart:ji(f,x)}]:[!1,h,{}]}function ji(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function uR({page:e,...t}){let{router:n}=Hw(),r=p.useMemo(()=>Lw(n.routes,e,n.basename),[n.routes,e,n.basename]);return r?p.createElement(fR,{page:e,matches:r,...t}):null}function dR(e){let{manifest:t,routeModules:n}=Ww(),[r,s]=p.useState([]);return p.useEffect(()=>{let i=!1;return rR(e,t,n).then(o=>{i||s(o)}),()=>{i=!0}},[e,t,n]),r}function fR({page:e,matches:t,...n}){let r=Gr(),{manifest:s,routeModules:i}=Ww(),{basename:o}=Hw(),{loaderData:l,matches:c}=lR(),u=p.useMemo(()=>Qg(e,t,c,s,r,"data"),[e,t,c,s,r]),d=p.useMemo(()=>Qg(e,t,c,s,r,"assets"),[e,t,c,s,r]),f=p.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let w=new Set,v=!1;if(t.forEach(m=>{var y;let g=s.routes[m.route.id];!g||!g.hasLoader||(!u.some(j=>j.route.id===m.route.id)&&m.route.id in l&&((y=i[m.route.id])!=null&&y.shouldRevalidate)||g.hasClientLoader?v=!0:w.add(m.route.id))}),w.size===0)return[];let b=eR(e,o,"data");return v&&w.size>0&&b.searchParams.set("_routes",t.filter(m=>w.has(m.route.id)).map(m=>m.route.id).join(",")),[b.pathname+b.search]},[o,l,r,s,u,t,e,i]),h=p.useMemo(()=>sR(d,s),[d,s]),x=dR(d);return p.createElement(p.Fragment,null,f.map(w=>p.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...n})),h.map(w=>p.createElement("link",{key:w,rel:"modulepreload",href:w,...n})),x.map(({key:w,link:v})=>p.createElement("link",{key:w,nonce:n.nonce,...v})))}function hR(...e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}var Kw=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Kw&&(window.__reactRouterVersion="7.8.1")}catch{}var Qw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Gw=p.forwardRef(function({onClick:t,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:f,...h},x){let{basename:w}=p.useContext(bn),v=typeof u=="string"&&Qw.test(u),b,m=!1;if(typeof u=="string"&&v&&(b=u,Kw))try{let P=new URL(window.location.href),T=u.startsWith("//")?new URL(P.protocol+u):new URL(u),$=ir(T.pathname,w);T.origin===P.origin&&$!=null?u=$+T.search+T.hash:m=!0}catch{xn(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let g=TA(u,{relative:s}),[y,j,S]=cR(r,h),N=yR(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:s,viewTransition:f});function C(P){t&&t(P),P.defaultPrevented||N(P)}let E=p.createElement("a",{...h,...S,href:b||g,onClick:m||i?t:C,ref:hR(x,j),target:c,"data-discover":!v&&n==="render"?"true":void 0});return y&&!v?p.createElement(p.Fragment,null,E,p.createElement(uR,{page:g})):E});Gw.displayName="Link";var pR=p.forwardRef(function({"aria-current":t="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:l,children:c,...u},d){let f=_o(o,{relative:u.relative}),h=Gr(),x=p.useContext(ec),{navigator:w,basename:v}=p.useContext(bn),b=x!=null&&jR(f)&&l===!0,m=w.encodeLocation?w.encodeLocation(f).pathname:f.pathname,g=h.pathname,y=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;n||(g=g.toLowerCase(),y=y?y.toLowerCase():null,m=m.toLowerCase()),y&&v&&(y=ir(y,v)||y);const j=m!=="/"&&m.endsWith("/")?m.length-1:m.length;let S=g===m||!s&&g.startsWith(m)&&g.charAt(j)==="/",N=y!=null&&(y===m||!s&&y.startsWith(m)&&y.charAt(m.length)==="/"),C={isActive:S,isPending:N,isTransitioning:b},E=S?t:void 0,P;typeof r=="function"?P=r(C):P=[r,S?"active":null,N?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let T=typeof i=="function"?i(C):i;return p.createElement(Gw,{...u,"aria-current":E,className:P,ref:d,style:T,to:o,viewTransition:l},typeof c=="function"?c(C):c)});pR.displayName="NavLink";var mR=p.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:r,replace:s,state:i,method:o=Fa,action:l,onSubmit:c,relative:u,preventScrollReset:d,viewTransition:f,...h},x)=>{let w=wR(),v=bR(l,{relative:u}),b=o.toLowerCase()==="get"?"get":"post",m=typeof l=="string"&&Qw.test(l),g=y=>{if(c&&c(y),y.defaultPrevented)return;y.preventDefault();let j=y.nativeEvent.submitter,S=(j==null?void 0:j.getAttribute("formmethod"))||o;w(j||y.currentTarget,{fetcherKey:t,method:S,navigate:n,replace:s,state:i,relative:u,preventScrollReset:d,viewTransition:f})};return p.createElement("form",{ref:x,method:b,action:v,onSubmit:r?c:g,...h,"data-discover":!m&&e==="render"?"true":void 0})});mR.displayName="Form";function gR(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function qw(e){let t=p.useContext(ci);return Pe(t,gR(e)),t}function yR(e,{target:t,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let l=AA(),c=Gr(),u=_o(e,{relative:i});return p.useCallback(d=>{if(YA(d,t)){d.preventDefault();let f=n!==void 0?n:Id(c)===Id(u);l(e,{replace:f,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[c,l,u,n,r,t,e,s,i,o])}var xR=0,vR=()=>`__${String(++xR)}__`;function wR(){let{router:e}=qw("useSubmit"),{basename:t}=p.useContext(bn),n=UA();return p.useCallback(async(r,s={})=>{let{action:i,method:o,encType:l,formData:c,body:u}=JA(r,t);if(s.navigate===!1){let d=s.fetcherKey||vR();await e.fetch(d,n,s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:u,formMethod:s.method||o,formEncType:s.encType||l,flushSync:s.flushSync})}else await e.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:u,formMethod:s.method||o,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[e,t,n])}function bR(e,{relative:t}={}){let{basename:n}=p.useContext(bn),r=p.useContext(qt);Pe(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={..._o(e||".",{relative:t})},o=Gr();if(e==null){i.search=o.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(d=>d==="")){l.delete("index"),c.filter(f=>f).forEach(f=>l.append("index",f));let d=l.toString();i.search=d?`?${d}`:""}}return(!e||e===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:un([n,i.pathname])),Id(i)}function jR(e,{relative:t}={}){let n=p.useContext(zw);Pe(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=qw("useViewTransitionState"),s=_o(e,{relative:t});if(!n.isTransitioning)return!1;let i=ir(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=ir(n.nextLocation.pathname,r)||n.nextLocation.pathname;return jl(s.pathname,o)!=null||jl(s.pathname,i)!=null}function kR({slide:e,index:t,isActive:n,onClick:r,onDragStart:s,onDragOver:i,onDrop:o}){return a.jsxs(_.div,{className:Ee("group relative cursor-pointer rounded border md:rounded-lg border-2 transition-all duration-200 touch-target",n?"glass-border-active frost-subtle":"glass-border glass-hover-border"),onClick:r,draggable:!0,onDragStart:s,onDragOver:i,onDrop:o,whileHover:{scale:1.02},whileTap:{scale:.98},children:[a.jsx("div",{className:"aspect-[4/3] p-0.5 md:p-1 lg:p-3",children:a.jsx("div",{className:"w-full h-full frost-subtle rounded glass-border relative overflow-hidden min-h-[40px] md:min-h-[60px]",children:e.blocks.map(l=>a.jsx("div",{className:Ee("absolute rounded-sm",l.type==="text"&&"frost-card",l.type==="image"&&"frost-strong",l.type==="note"&&"frost-subtle"),style:{left:`${l.x/800*100}%`,top:`${l.y/600*100}%`,width:`${l.w/800*100}%`,height:`${l.h/600*100}%`,transform:l.rotation?`rotate(${l.rotation}deg)`:void 0}},l.id))})}),a.jsxs("div",{className:"px-1 md:px-2 lg:px-3 pb-1 md:pb-2 lg:pb-3 hidden lg:block",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-xs font-medium text-ink/70",children:t+1}),a.jsxs("span",{className:"text-xs text-ink/50",children:[e.blocks.length," blocks"]})]}),e.title&&a.jsx("div",{className:"text-xs text-ink/80 mt-1 truncate",children:e.title})]}),n&&a.jsx(_.div,{className:"absolute inset-0 border-2 border-blue-500 rounded-lg pointer-events-none",layoutId:"activeSlide",transition:{type:"spring",stiffness:380,damping:30}})]})}const Gg=e=>{let t;const n=new Set,r=(u,d)=>{const f=typeof u=="function"?u(t):u;if(!Object.is(f,t)){const h=t;t=d??(typeof f!="object"||f===null)?f:Object.assign({},t,f),n.forEach(x=>x(t,h))}},s=()=>t,l={setState:r,getState:s,getInitialState:()=>c,subscribe:u=>(n.add(u),()=>n.delete(u))},c=t=e(r,s,l);return l},SR=e=>e?Gg(e):Gg,NR=e=>e;function CR(e,t=NR){const n=rn.useSyncExternalStore(e.subscribe,rn.useCallback(()=>t(e.getState()),[e,t]),rn.useCallback(()=>t(e.getInitialState()),[e,t]));return rn.useDebugValue(n),n}const qg=e=>{const t=SR(e),n=r=>CR(t,r);return Object.assign(n,t),n},ER=e=>e?qg(e):qg,je=[];for(let e=0;e<256;++e)je.push((e+256).toString(16).slice(1));function PR(e,t=0){return(je[e[t+0]]+je[e[t+1]]+je[e[t+2]]+je[e[t+3]]+"-"+je[e[t+4]]+je[e[t+5]]+"-"+je[e[t+6]]+je[e[t+7]]+"-"+je[e[t+8]]+je[e[t+9]]+"-"+je[e[t+10]]+je[e[t+11]]+je[e[t+12]]+je[e[t+13]]+je[e[t+14]]+je[e[t+15]]).toLowerCase()}let au;const TR=new Uint8Array(16);function AR(){if(!au){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");au=crypto.getRandomValues.bind(crypto)}return au(TR)}const RR=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Yg={randomUUID:RR};function xa(e,t,n){var s;if(Yg.randomUUID&&!e)return Yg.randomUUID();e=e||{};const r=e.random??((s=e.rng)==null?void 0:s.call(e))??AR();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,PR(r)}const et=ER((e,t)=>({brief:null,setBrief:n=>{e({brief:n,isDirty:!1}),n&&t().pushHistory()},currentSlideIndex:0,setCurrentSlideIndex:n=>e({currentSlideIndex:n}),selectedBlockIds:[],setSelectedBlockIds:n=>e({selectedBlockIds:n}),selectBlock:(n,r=!1)=>{const{selectedBlockIds:s}=t();if(r){const i=s.includes(n)?s.filter(o=>o!==n):[...s,n];e({selectedBlockIds:i})}else e({selectedBlockIds:[n]})},clearSelection:()=>e({selectedBlockIds:[]}),zoom:1,setZoom:n=>e({zoom:Math.max(.1,Math.min(3,n))}),panX:0,panY:0,setPan:(n,r)=>e({panX:n,panY:r}),showGrid:!0,toggleGrid:()=>e(n=>({showGrid:!n.showGrid})),isDirty:!1,setDirty:n=>e({isDirty:n}),lastSaved:null,setLastSaved:n=>e({lastSaved:n}),history:[],historyIndex:-1,pushHistory:()=>{const{brief:n,history:r,historyIndex:s}=t();if(!n)return;const i=r.slice(0,s+1);i.push(JSON.parse(JSON.stringify(n))),e({history:i.slice(-50),historyIndex:Math.min(i.length-1,49)})},undo:()=>{const{history:n,historyIndex:r}=t();if(r>0){const s=n[r-1];e({brief:JSON.parse(JSON.stringify(s)),historyIndex:r-1,isDirty:!0})}},redo:()=>{const{history:n,historyIndex:r}=t();if(r<n.length-1){const s=n[r+1];e({brief:JSON.parse(JSON.stringify(s)),historyIndex:r+1,isDirty:!0})}},canUndo:()=>t().historyIndex>0,canRedo:()=>t().historyIndex<t().history.length-1,addBlock:n=>{const{brief:r,currentSlideIndex:s}=t();if(!r||!r.slides[s])return;const i={...n,id:xa()},o={...r};o.slides[s].blocks.push(i),e({brief:o,isDirty:!0,selectedBlockIds:[i.id]}),t().pushHistory()},updateBlock:(n,r)=>{const{brief:s,currentSlideIndex:i}=t();if(!s||!s.slides[i])return;const o={...s},l=o.slides[i],c=l.blocks.findIndex(u=>u.id===n);c>=0&&(l.blocks[c]={...l.blocks[c],...r},e({brief:o,isDirty:!0}))},deleteBlocks:n=>{const{brief:r,currentSlideIndex:s,selectedBlockIds:i}=t();if(!r||!r.slides[s])return;const o={...r};o.slides[s].blocks=o.slides[s].blocks.filter(l=>!n.includes(l.id)),e({brief:o,isDirty:!0,selectedBlockIds:i.filter(l=>!n.includes(l))}),t().pushHistory()},duplicateBlocks:n=>{const{brief:r,currentSlideIndex:s}=t();if(!r||!r.slides[s])return;const l=r.slides[s].blocks.filter(u=>n.includes(u.id)).map(u=>({...u,id:`block-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:u.x+20,y:u.y+20})),c={...r};c.slides[s].blocks.push(...l),e({brief:c,isDirty:!0,selectedBlockIds:l.map(u=>u.id)}),t().pushHistory()},addSlide:(n={})=>{const{brief:r}=t();if(!r)return;const s={id:xa(),title:n.title||`Slide ${r.slides.length+1}`,blocks:n.blocks||[],captureRefs:n.captureRefs||[],...n},i={...r};i.slides.push(s),i.slideCount=i.slides.length,e({brief:i,isDirty:!0,currentSlideIndex:i.slides.length-1,selectedBlockIds:[]}),t().pushHistory()},updateSlide:(n,r)=>{const{brief:s}=t();if(!s||!s.slides[n])return;const i={...s};i.slides[n]={...i.slides[n],...r},e({brief:i,isDirty:!0})},deleteSlide:n=>{const{brief:r,currentSlideIndex:s}=t();if(!r||r.slides.length<=1)return;const i={...r};i.slides.splice(n,1),i.slideCount=i.slides.length;const o=n>=i.slides.length?i.slides.length-1:s===n?Math.max(0,n-1):s>n?s-1:s;e({brief:i,isDirty:!0,currentSlideIndex:o,selectedBlockIds:[]}),t().pushHistory()},duplicateSlide:n=>{const{brief:r}=t();if(!r||!r.slides[n])return;const s=r.slides[n],i={...s,id:xa(),title:`${s.title} Copy`,blocks:s.blocks.map(l=>({...l,id:xa()}))},o={...r};o.slides.splice(n+1,0,i),o.slideCount=o.slides.length,e({brief:o,isDirty:!0,currentSlideIndex:n+1,selectedBlockIds:[]}),t().pushHistory()},reorderSlides:(n,r)=>{const{brief:s}=t();if(!s)return;const i={...s},[o]=i.slides.splice(n,1);i.slides.splice(r,0,o),e({brief:i,isDirty:!0,currentSlideIndex:r}),t().pushHistory()}}));function MR(){const{brief:e,currentSlideIndex:t,setCurrentSlideIndex:n,addSlide:r,deleteSlide:s,duplicateSlide:i,reorderSlides:o}=et(),[l,c]=p.useState(null);if(!e)return null;const u=d=>{const f=e.slides.findIndex(x=>x.id===d[0].id),h=d.findIndex(x=>x.id===d[0].id);f!==h&&o(f,h)};return a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-1 md:p-2 lg:p-4 glass-border-b",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1 md:mb-2 lg:mb-3",children:[a.jsx("h3",{className:"font-medium text-xs md:text-sm lg:text-base hidden lg:block",children:"Slides"}),a.jsx("h3",{className:"font-medium text-xs lg:hidden",children:"S"}),a.jsx("button",{onClick:()=>r(),className:"p-1 md:p-1.5 glass-hover rounded-lg transition-colors touch-target",title:"Add slide",children:a.jsx(Kr,{className:"w-3 md:w-4 h-3 md:h-4"})})]}),a.jsxs("div",{className:"text-xs text-ink/50 hidden lg:block",children:[e.slides.length," slide",e.slides.length!==1?"s":""]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-1 md:p-2 lg:p-4 space-y-1 md:space-y-2 lg:space-y-3",children:a.jsx(bP,{axis:"y",values:e.slides,onReorder:u,className:"space-y-1 md:space-y-2 lg:space-y-3",children:e.slides.map((d,f)=>a.jsx(NP,{value:d,className:"relative",onDragStart:()=>c(f),onDragEnd:()=>c(null),children:a.jsxs("div",{className:"relative group",children:[a.jsx(kR,{slide:d,index:f,isActive:f===t,onClick:()=>n(f)}),a.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsxs(zr,{trigger:a.jsx("button",{className:"p-1 bg-black/50 hover:bg-black/70 rounded transition-colors",children:a.jsx(yo,{className:"w-3 h-3"})}),align:"right",children:[a.jsx(we,{onClick:()=>i(f),icon:a.jsx(vl,{className:"w-4 h-4"}),children:"Duplicate Slide"}),e.slides.length>1&&a.jsx(we,{onClick:()=>s(f),icon:a.jsx(kh,{className:"w-4 h-4"}),destructive:!0,children:"Delete Slide"})]})}),l===f&&a.jsx(_.div,{className:"absolute inset-0 bg-blue-500/20 border-2 border-blue-500 rounded-lg pointer-events-none",initial:{opacity:0},animate:{opacity:1}})]})},d.id))})})]})}function DR({block:e}){const{updateBlock:t,selectedBlockIds:n}=et(),[r,s]=p.useState(!1),[i,o]=p.useState(e.text),l=p.useRef(null),c=n.includes(e.id);p.useEffect(()=>{o(e.text)},[e.text]),p.useEffect(()=>{r&&l.current&&(l.current.focus(),l.current.select())},[r]);const u=h=>{h.stopPropagation(),s(!0)},d=()=>{s(!1),i!==e.text&&t(e.id,{text:i})},f=h=>{h.key==="Enter"&&!h.shiftKey?(h.preventDefault(),d()):h.key==="Escape"&&(o(e.text),s(!1))};return r?a.jsx("textarea",{ref:l,value:i,onChange:h=>o(h.target.value),onBlur:d,onKeyDown:f,className:"w-full h-full resize-none border-none outline-none bg-transparent",style:{fontSize:e.fontSize||16,fontWeight:e.weight||400,textAlign:e.align||"left",lineHeight:1.4}}):a.jsx("div",{className:Ee("w-full h-full flex items-start cursor-text",c&&"ring-2 ring-blue-500 ring-offset-2"),onDoubleClick:u,style:{fontSize:e.fontSize||16,fontWeight:e.weight||400,textAlign:e.align||"left",lineHeight:1.4},children:a.jsx("div",{className:"w-full p-2 break-words",children:e.text||"Click to edit text"})})}function LR({block:e}){const{selectedBlockIds:t}=et(),[n,r]=p.useState(!1),[s,i]=p.useState(!1),o=t.includes(e.id),l=()=>{i(!0),r(!1)},c=()=>{r(!0),i(!1)};return a.jsxs("div",{className:Ee("w-full h-full relative overflow-hidden rounded glass-border",o&&"ring-2 ring-blue-500 ring-offset-2"),children:[n?a.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-gray-400",children:[a.jsx("div",{className:"text-sm mb-1",children:"Image failed to load"}),a.jsx("div",{className:"text-xs opacity-70",children:"Check the URL"})]})}):a.jsxs(a.Fragment,{children:[a.jsx("img",{src:e.src,alt:e.alt||"Image",className:Ee("w-full h-full object-cover transition-opacity duration-200",s?"opacity-100":"opacity-0"),onLoad:l,onError:c}),!s&&a.jsx("div",{className:"absolute inset-0 bg-gray-100 animate-pulse flex items-center justify-center",children:a.jsx("div",{className:"text-gray-400 text-sm",children:"Loading..."})})]}),e.sourceCaptureId&&a.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsxs("div",{className:"bg-black/70 text-ink text-xs px-2 py-1 rounded flex items-center gap-1",children:[a.jsx(sr,{className:"w-3 h-3"}),"Source"]})})]})}function IR({block:e}){const{updateBlock:t,selectedBlockIds:n}=et(),[r,s]=p.useState(!1),[i,o]=p.useState(e.text),l=p.useRef(null),c=n.includes(e.id);p.useEffect(()=>{o(e.text)},[e.text]),p.useEffect(()=>{r&&l.current&&(l.current.focus(),l.current.select())},[r]);const u=h=>{h.stopPropagation(),s(!0)},d=()=>{s(!1),i!==e.text&&t(e.id,{text:i})},f=h=>{h.key==="Enter"&&!h.shiftKey?(h.preventDefault(),d()):h.key==="Escape"&&(o(e.text),s(!1))};return r?a.jsx("div",{className:"w-full h-full frost-card glass-border rounded p-2",children:a.jsx("textarea",{ref:l,value:i,onChange:h=>o(h.target.value),onBlur:d,onKeyDown:f,className:"w-full h-full resize-none border-none outline-none bg-transparent text-ink text-sm",placeholder:"Add your note..."})}):a.jsxs("div",{className:Oo("w-full h-full frost-card glass-border rounded p-2 cursor-text","glass-shadow hover:glass-shadow-hover transition-shadow",c&&"ring-2 glass-border ring-offset-2"),onDoubleClick:u,children:[a.jsx("div",{className:"w-full h-full text-ink text-sm break-words overflow-hidden",children:e.text||"Add your note..."}),a.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 frost-strong rounded-full glass-border opacity-70"})]})}const Yw=8;function OR(e,t,n=Yw){const r=[],s={left:e.x,right:e.x+e.w,top:e.y,bottom:e.y+e.h,centerX:e.x+e.w/2,centerY:e.y+e.h/2};return t.forEach(i=>{const o={left:i.x,right:i.x+i.w,top:i.y,bottom:i.y+i.h,centerX:i.x+i.w/2,centerY:i.y+i.h/2};Object.entries(s).forEach(([l,c])=>{l==="top"||l==="bottom"||l==="centerY"||Object.entries(o).forEach(([u,d])=>{u==="top"||u==="bottom"||u==="centerY"||Math.abs(c-d)<=n&&r.push({type:"vertical",position:d,start:Math.min(e.y,i.y),end:Math.max(e.y+e.h,i.y+i.h)})})}),Object.entries(s).forEach(([l,c])=>{l==="left"||l==="right"||l==="centerX"||Object.entries(o).forEach(([u,d])=>{u==="left"||u==="right"||u==="centerX"||Math.abs(c-d)<=n&&r.push({type:"horizontal",position:d,start:Math.min(e.x,i.x),end:Math.max(e.x+e.w,i.x+i.w)})})})}),r}function FR(e,t,n=Yw){let r={...e};return t.forEach(s=>{if(s.type==="vertical"){const i=Math.abs(e.x-s.position),o=Math.abs(e.x+e.w-s.position),l=Math.abs(e.x+e.w/2-s.position);i<=n?r.x=s.position:o<=n?r.x=s.position-e.w:l<=n&&(r.x=s.position-e.w/2)}else{const i=Math.abs(e.y-s.position),o=Math.abs(e.y+e.h-s.position),l=Math.abs(e.y+e.h/2-s.position);i<=n?r.y=s.position:o<=n?r.y=s.position-e.h:l<=n&&(r.y=s.position-e.h/2)}}),r}const _R=800,VR=600;function zR(){const{brief:e,currentSlideIndex:t,zoom:n,panX:r,panY:s,showGrid:i,selectedBlockIds:o,selectBlock:l,clearSelection:c,updateBlock:u}=et(),d=p.useRef(null),[f,h]=p.useState(!1),[x,w]=p.useState({x:0,y:0}),[v,b]=p.useState([]),m=e==null?void 0:e.slides[t],g=p.useCallback(N=>{N.target===N.currentTarget&&c()},[c]),y=p.useCallback((N,C)=>{C.stopPropagation(),o.includes(N)||l(N,C.metaKey||C.ctrlKey),h(!0),w({x:C.clientX,y:C.clientY})},[o,l]),j=p.useCallback(N=>{if(!f||!m)return;const C=(N.clientX-x.x)/n,E=(N.clientY-x.y)/n,P=m.blocks.filter(T=>!o.includes(T.id)).map(T=>({x:T.x,y:T.y,w:T.w,h:T.h}));o.forEach(T=>{const $=m.blocks.find(V=>V.id===T);if($){const V={x:Math.max(0,$.x+C),y:Math.max(0,$.y+E),w:$.w,h:$.h},ge=OR(V,P),Xe=FR(V,ge);u(T,{x:Xe.x,y:Xe.y}),b(ge)}}),w({x:N.clientX,y:N.clientY})},[f,x,n,m,o,u]),S=p.useCallback(()=>{h(!1),b([])},[]);return m?a.jsxs("div",{ref:d,className:"flex-1 overflow-hidden relative glass-canvas canvas-mobile",onMouseMove:j,onMouseUp:S,onMouseLeave:S,onTouchMove:N=>{if(N.touches.length===1){const C=N.touches[0];j({clientX:C.clientX,clientY:C.clientY})}},onTouchEnd:S,children:[a.jsx(_.div,{className:"absolute inset-0 flex items-center justify-center overflow-auto md:overflow-hidden",style:{transform:`translate(${r}px, ${s}px) scale(${n})`},children:a.jsxs("div",{className:Ee("relative frost-card rounded-lg glass-shadow",i&&"canvas-grid","min-w-[320px] md:min-w-[800px]"),style:{width:Math.max(320,_R*(window.innerWidth<768?.8:1)),height:Math.max(240,VR*(window.innerWidth<768?.8:1))},onClick:g,children:[m.blocks.map(N=>{const C=o.includes(N.id);return a.jsxs("div",{className:Ee("absolute cursor-move touch-target",C&&"ring-2 glass-border ring-offset-2"),style:{left:N.x,top:N.y,width:N.w,height:N.h,transform:N.rotation?`rotate(${N.rotation}deg)`:void 0},onMouseDown:E=>y(N.id,E),onTouchStart:E=>{if(E.touches.length===1){const P=E.touches[0];y(N.id,{clientX:P.clientX,clientY:P.clientY,stopPropagation:()=>E.stopPropagation(),metaKey:!1,ctrlKey:!1})}},children:[N.type==="text"&&a.jsx(DR,{block:N}),N.type==="image"&&a.jsx(LR,{block:N}),N.type==="note"&&a.jsx(IR,{block:N}),C&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute -top-1 -left-1 w-3 md:w-2 h-3 md:h-2 frost-strong rounded-full cursor-nw-resize touch-target"}),a.jsx("div",{className:"absolute -top-1 -right-1 w-3 md:w-2 h-3 md:h-2 frost-strong rounded-full cursor-ne-resize touch-target"}),a.jsx("div",{className:"absolute -bottom-1 -left-1 w-3 md:w-2 h-3 md:h-2 frost-strong rounded-full cursor-sw-resize touch-target"}),a.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 md:w-2 h-3 md:h-2 frost-strong rounded-full cursor-se-resize touch-target"}),a.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-3 md:w-2 h-3 md:h-2 frost-strong rounded-full cursor-n-resize touch-target"}),a.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-3 md:w-2 h-3 md:h-2 frost-strong rounded-full cursor-s-resize touch-target"}),a.jsx("div",{className:"absolute -left-1 top-1/2 -translate-y-1/2 w-3 md:w-2 h-3 md:h-2 frost-strong rounded-full cursor-w-resize touch-target"}),a.jsx("div",{className:"absolute -right-1 top-1/2 -translate-y-1/2 w-3 md:w-2 h-3 md:h-2 frost-strong rounded-full cursor-e-resize touch-target"})]})]},N.id)}),v.map((N,C)=>a.jsx("div",{className:Ee("snap-line",N.type==="horizontal"?"snap-line-h":"snap-line-v"),style:{[N.type==="horizontal"?"top":"left"]:N.position,[N.type==="horizontal"?"left":"top"]:N.start,[N.type==="horizontal"?"width":"height"]:N.end-N.start}},C))]})}),a.jsxs("div",{className:"absolute bottom-2 md:bottom-4 right-2 md:right-4 glass rounded-lg px-2 md:px-3 py-1 text-xs md:text-sm",children:[Math.round(n*100),"%"]})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsx("div",{className:"text-ink/50",children:"No slide selected"})})}function ki({children:e,className:t}){return a.jsx(_.div,{className:Ee("glass rounded-lg md:rounded-xl p-1 md:p-2 flex items-center gap-1 md:gap-2 flex-shrink-0 shadow-sm",t),initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.2},children:e})}function Me({children:e,onClick:t,active:n=!1,disabled:r=!1,title:s}){return a.jsx(_.button,{className:Ee("icon-center p-1 md:p-1.5 lg:p-2 rounded md:rounded-lg transition-all duration-200 touch-target flex-shrink-0","hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-1 focus:ring-offset-gray-900",n&&"bg-blue-500/20 text-blue-400",r&&"opacity-50 cursor-not-allowed"),onClick:t,disabled:r,title:s,whileHover:r?void 0:{scale:1.03},whileTap:r?void 0:{scale:.95},children:e})}function rc(e){var l;const t=$r(),{data:n,isLoading:r,error:s}=Lt({queryKey:["briefs",e],queryFn:()=>B3(e),enabled:!!e,staleTime:30*1e3}),i=wt({mutationFn:c=>Rw(e,c),onSuccess:c=>{t.setQueryData(["briefs",e],c),t.setQueriesData({queryKey:["briefs"]},u=>Array.isArray(u)?u.map(d=>d.id===c.id?{...d,...c,slideCount:c.slides.length}:d):u)}}),o=wt({mutationFn:()=>$3(e)});return{brief:n,isLoading:r,error:s,saveBrief:i.mutate,exportBrief:o.mutate,isSaving:i.isPending,isExporting:o.isPending,exportJobId:(l=o.data)==null?void 0:l.jobId,saveError:i.error,exportError:o.error}}function BR(e){return Lt({queryKey:["jobs",e],queryFn:()=>jobsService.get(e),enabled:!!e,refetchInterval:t=>(t==null?void 0:t.status)==="pending"||(t==null?void 0:t.status)==="running"?2e3:!1})}const UR=!0;function Xg({keys:e,className:t}){return a.jsx("div",{className:Ee("flex items-center gap-1",t),children:e.map((n,r)=>a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 text-xs font-mono bg-white/10 rounded border border-white/20",children:n}),r<e.length-1&&a.jsx("span",{className:"text-xs text-ink/50",children:"+"})]},r))})}function $R(){var P;const{zoom:e,setZoom:t,showGrid:n,toggleGrid:r,selectedBlockIds:s,addBlock:i,undo:o,redo:l,canUndo:c,canRedo:u,brief:d}=et(),{exportBrief:f,isExporting:h,exportJobId:x}=rc((d==null?void 0:d.id)||""),w=x&&UR?{id:x,status:"completed",result:{url:"https://docs.google.com/presentation/d/mock-export-url"}}:null,{data:v}=BR(x),b=w,[m,g]=p.useState(!1),y=()=>{i({type:"text",x:100,y:100,w:200,h:50,text:"Click to edit text",align:"left",fontSize:16,weight:400})},j=()=>{i({type:"image",x:100,y:100,w:200,h:150,src:"https://images.unsplash.com/photo-1557804506-669a67965ba0?w=200&h=150&fit=crop",alt:"Placeholder image"})},S=()=>{i({type:"note",x:100,y:100,w:150,h:100,text:"Add your note here..."})},N=()=>t(e*1.2),C=()=>t(e/1.2),E=()=>{d&&f()};return a.jsxs("div",{className:"flex items-center gap-1 md:gap-2 overflow-x-auto scrollbar-hide",children:[a.jsxs(ki,{children:[a.jsx(Me,{onClick:y,title:"Add Text",children:a.jsx(Sh,{className:"w-4 h-4 stroke-1"})}),a.jsx(Me,{onClick:j,title:"Add Image",children:a.jsx(Ys,{className:"w-4 h-4 stroke-1"})}),a.jsx(Me,{onClick:S,title:"Add Note",children:a.jsx(tT,{className:"w-4 h-4 stroke-1"})})]}),s.length>1&&a.jsxs(ki,{className:"hidden lg:flex",children:[a.jsx(Me,{title:"Align Left",children:a.jsx(Qc,{className:"w-4 h-4 stroke-1"})}),a.jsx(Me,{title:"Align Center",children:a.jsx(TP,{className:"w-4 h-4 stroke-1"})}),a.jsx(Me,{title:"Align Right",children:a.jsx(AP,{className:"w-4 h-4 stroke-1"})}),a.jsx("div",{className:"w-px h-6 bg-white/20 mx-1"}),a.jsx(Me,{title:"Align Top",children:a.jsx(Qc,{className:"w-4 h-4 stroke-1"})}),a.jsx(Me,{title:"Align Middle",children:a.jsx(Qc,{className:"w-4 h-4 stroke-1"})}),a.jsx(Me,{title:"Align Bottom",children:a.jsx(GP,{className:"w-4 h-4 stroke-1"})})]}),a.jsxs(ki,{children:[a.jsx(Me,{onClick:C,title:"Zoom Out",children:a.jsx(uT,{className:"w-4 h-4 stroke-1"})}),a.jsxs("span",{className:"text-xs px-1 md:px-2 min-w-[35px] md:min-w-[50px] text-center",children:[Math.round(e*100),"%"]}),a.jsx(Me,{onClick:N,title:"Zoom In",children:a.jsx(cT,{className:"w-4 h-4 stroke-1"})}),a.jsx("div",{className:"w-px h-4 md:h-6 bg-white/20 mx-0.5 md:mx-1 hidden md:block"}),a.jsx(Me,{onClick:r,active:n,title:"Grid",children:a.jsx(R1,{className:"w-4 h-4 stroke-1"})})]}),a.jsxs(ki,{className:"hidden md:flex",children:[a.jsx(Me,{onClick:o,disabled:!c(),title:"Undo",children:a.jsx(oT,{className:"w-4 h-4 stroke-1"})}),a.jsx(Me,{onClick:l,disabled:!u(),title:"Redo",children:a.jsx(YP,{className:"w-4 h-4 stroke-1"})})]}),a.jsxs(ki,{children:[a.jsx(Me,{onClick:()=>g(!0),title:"AI",children:a.jsx(eT,{className:"w-4 h-4 stroke-1"})}),a.jsxs(Me,{onClick:E,disabled:h,title:"Export",children:[a.jsx(FP,{className:"w-4 h-4 stroke-1"}),h&&a.jsx(_.div,{className:"absolute inset-0 bg-blue-500/20 rounded-lg",animate:{opacity:[.5,1,.5]},transition:{repeat:1/0,duration:1}})]})]}),a.jsxs("div",{className:"hidden 2xl:flex items-center gap-3 text-xs text-ink/50",children:[a.jsx(Xg,{keys:["","S"]}),a.jsx("span",{children:"Save"}),a.jsx(Xg,{keys:["G"]}),a.jsx("span",{children:"Grid"})]}),b&&a.jsxs("div",{className:"glass rounded-lg px-2 py-1 text-xs whitespace-nowrap",children:[b.status==="pending"&&"Queued...",b.status==="running"&&"Exporting...",b.status==="completed"&&a.jsx("a",{href:(P=b.result)==null?void 0:P.url,target:"_blank",rel:"noopener noreferrer",className:"text-green-400 hover:underline",children:"View Slides"}),b.status==="failed"&&a.jsx("span",{className:"text-red-400",children:"Export failed"})]})]})}function HR(){const{selectedBlockIds:e,deleteBlocks:t,duplicateBlocks:n,undo:r,redo:s,canUndo:i,canRedo:o,toggleGrid:l,clearSelection:c}=et();p.useEffect(()=>{const u=d=>{var x;if(d.target instanceof HTMLInputElement||d.target instanceof HTMLTextAreaElement||d.target instanceof HTMLSelectElement||((x=d.target)==null?void 0:x.contentEditable)==="true")return;const f=d.metaKey||d.ctrlKey,h=d.shiftKey;switch(d.key){case"Backspace":case"Delete":e.length>0&&(d.preventDefault(),t(e));break;case"d":f&&e.length>0&&(d.preventDefault(),n(e));break;case"z":f&&!h&&i()?(d.preventDefault(),r()):f&&h&&o()&&(d.preventDefault(),s());break;case"y":f&&o()&&(d.preventDefault(),s());break;case"g":f||(d.preventDefault(),l());break;case"Escape":d.preventDefault(),c();break;case"a":if(f){d.preventDefault();const{brief:w,currentSlideIndex:v}=et.getState();if(w!=null&&w.slides[v]){const b=w.slides[v].blocks.map(m=>m.id);et.getState().setSelectedBlockIds(b)}}break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":if(e.length>0){d.preventDefault();const w=h?10:1,v=d.key==="ArrowLeft"?-w:d.key==="ArrowRight"?w:0,b=d.key==="ArrowUp"?-w:d.key==="ArrowDown"?w:0;e.forEach(m=>{var N;const{brief:g,currentSlideIndex:y,updateBlock:j}=et.getState(),S=(N=g==null?void 0:g.slides[y])==null?void 0:N.blocks.find(C=>C.id===m);S&&j(m,{x:Math.max(0,S.x+v),y:Math.max(0,S.y+b)})})}break}};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[e,t,n,r,s,i,o,l,c]),p.useEffect(()=>{const u=d=>{(d.metaKey||d.ctrlKey)&&d.key==="s"&&d.preventDefault()};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[])}const WR=800,Qi="brief-draft-";function KR(e){const{brief:t,isDirty:n,setDirty:r,setLastSaved:s}=et(),{saveBrief:i,isSaving:o}=rc(e||""),l=p.useRef(),c=p.useRef(""),u=h=>{try{localStorage.setItem(`${Qi}${e}`,JSON.stringify({data:h,timestamp:Date.now()}))}catch(x){console.warn("Failed to save draft to localStorage:",x)}},d=()=>{try{const h=localStorage.getItem(`${Qi}${e}`);if(h){const x=JSON.parse(h);return{data:x.data,timestamp:x.timestamp}}}catch(h){console.warn("Failed to load draft from localStorage:",h)}return null},f=()=>{try{localStorage.removeItem(`${Qi}${e}`)}catch(h){console.warn("Failed to clear draft from localStorage:",h)}};return p.useEffect(()=>{if(!(!t||!n||o||!e||JSON.stringify(t)===c.current))return l.current&&clearTimeout(l.current),u(t),l.current=setTimeout(()=>{i(t)},WR),()=>{l.current&&clearTimeout(l.current)}},[t,n,o,i,r,s]),p.useEffect(()=>{if(!o&&t){const h=JSON.stringify(t);h!==c.current&&(r(!1),s(new Date),f(),c.current=h)}},[o,t,r,s]),p.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),{loadDraft:d,clearDraft:f,saveDraft:u}}function QR(e){const{setBrief:t}=et(),{brief:n}=rc(e||"");return{checkForDraft:()=>{if(!e)return{hasDraft:!1};try{const o=localStorage.getItem(`${Qi}${e}`);if(o&&n){const l=JSON.parse(o),c=l.timestamp,u=new Date(n.updatedAt).getTime();if(c>u)return{hasDraft:!0,draftData:l.data,draftTimestamp:c,serverTimestamp:u}}}catch(o){console.warn("Failed to check for draft:",o)}return{hasDraft:!1}},restoreDraft:o=>{t(o)},discardDraft:()=>{try{e&&localStorage.removeItem(`${Qi}${e}`)}catch(o){console.warn("Failed to discard draft:",o)}}}}function GR(){const{id:e}=MA(),{brief:t,isLoading:n}=rc(e||""),{brief:r,setBrief:s,isDirty:i,lastSaved:o}=et(),[l,c]=p.useState(!1),[u,d]=p.useState(null),{checkForDraft:f,restoreDraft:h,discardDraft:x}=QR(e);return KR(e),HR(),p.useEffect(()=>{if(t&&!r){s(t);const w=f();w.hasDraft&&(d(w),c(!0))}},[t,r,s,f]),p.useEffect(()=>{const w=v=>{i&&(v.preventDefault(),v.returnValue="You have unsaved changes. Are you sure you want to leave?")};return window.addEventListener("beforeunload",w),()=>window.removeEventListener("beforeunload",w)},[i]),n?a.jsx("div",{className:"h-screen flex items-center justify-center",children:a.jsxs("div",{className:"glass rounded-2xl p-8 text-center",children:[a.jsx("div",{className:"animate-spin w-8 h-8 border-2 glass-border border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-ink/70",children:"Loading brief..."})]})}):r?a.jsxs("div",{className:"h-screen flex flex-col glass-canvas overflow-hidden",children:[a.jsxs("div",{className:"glass-header h-14 md:h-16 px-3 md:px-6 flex items-center justify-between glass-border-b gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2 md:gap-4 min-w-0 flex-1",children:[a.jsx("h1",{className:"text-sm md:text-lg font-semibold truncate max-w-[150px] md:max-w-none",children:r.title}),a.jsxs("div",{className:"hidden md:flex items-center gap-2 text-sm text-ink/60",children:[a.jsx(bh,{className:"w-4 h-4"}),i?a.jsx("span",{children:"Unsaved changes"}):o?a.jsxs("span",{children:["Saved ",o.toLocaleTimeString()]}):a.jsx("span",{children:"All changes saved"})]})]}),a.jsx("div",{className:"flex-shrink-0",children:a.jsx($R,{})})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx("div",{className:"w-12 md:w-16 lg:w-64 glass glass-border-r flex flex-col flex-shrink-0",children:a.jsx(MR,{})}),a.jsx("div",{className:"flex-1 relative overflow-hidden",children:a.jsx(zR,{})}),a.jsx("div",{className:"hidden xl:flex w-80 glass glass-border-l flex-col flex-shrink-0",children:a.jsxs("div",{className:"p-3 md:p-4 glass-border-b",children:[a.jsx("h3",{className:"font-medium mb-4",children:"Properties"}),a.jsx("div",{className:"text-sm text-ink/50",children:"Select a block to edit properties"})]})})]}),a.jsx(Mt,{children:l&&a.jsx(_.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a.jsxs(_.div,{className:"glass rounded-2xl p-6 w-full max-w-md mx-4",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(Rd,{className:"w-6 h-6 text-yellow-400"}),a.jsx("h3",{className:"text-lg font-semibold",children:"Restore Draft?"})]}),a.jsx("p",{className:"text-ink/70 mb-6",children:"We found a more recent draft of this brief saved locally. Would you like to restore it?"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>{x(),c(!1)},className:"flex-1 px-4 py-2 glass rounded-lg hover:bg-white/10 transition-colors",children:"Discard Draft"}),a.jsx("button",{onClick:()=>{h(u.draftData),c(!1)},className:"flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors",children:"Restore Draft"})]})]})})})]}):a.jsx("div",{className:"h-screen flex items-center justify-center",children:a.jsxs("div",{className:"glass rounded-2xl p-8 text-center",children:[a.jsx(Rd,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Brief Not Found"}),a.jsx("p",{className:"text-ink/70",children:"The brief you're looking for doesn't exist."})]})})}function qR(){return a.jsx(GR,{})}function YR(e){return lt.get("/user-feeds",e)}function XR(e){return lt.post("/user-feeds",e)}function ZR(e,t){return lt.patch(`/user-feeds/${e}`,t)}function JR(e){return lt.del(`/user-feeds/${e}`)}function e5(){const e=$r(),{data:t=[],isLoading:n,error:r}=Lt({queryKey:["feeds"],queryFn:()=>YR(),staleTime:2*60*1e3}),s=wt({mutationFn:XR,onSuccess:l=>{e.setQueryData(["feeds"],(c=[])=>[l,...c])}}),i=wt({mutationFn:({id:l,...c})=>ZR(l,c),onSuccess:l=>{e.setQueryData(["feeds"],(c=[])=>c.map(u=>u.id===l.id?l:u))}}),o=wt({mutationFn:JR,onSuccess:(l,c)=>{e.setQueryData(["feeds"],(u=[])=>u.filter(d=>d.id!==c))}});return{feeds:t,isLoading:n,error:r,createFeed:s.mutateAsync,updateFeed:i.mutateAsync,deleteFeed:o.mutateAsync,isCreating:s.isPending,isUpdating:i.isPending,isDeleting:o.isPending}}const t5=[{title:"Vogue Fashion News",url:"https://www.vogue.com/rss"},{title:"TechCrunch",url:"https://techcrunch.com/feed/"},{title:"The Verge",url:"https://www.theverge.com/rss/index.xml"},{title:"Fast Company",url:"https://www.fastcompany.com/rss.xml"}];function n5(){const{currentProjectId:e}=Ro(),{feeds:t,createFeed:n,updateFeed:r,toggleFeed:s,deleteFeed:i,isCreating:o,isLoading:l}=e5(),[c,u]=p.useState(!1),[d,f]=p.useState(null),[h,x]=p.useState({feedUrl:"",title:""}),w=g=>{g.preventDefault(),h.feedUrl.trim()&&(d?r({id:d.id,feedUrl:h.feedUrl.trim(),title:h.title.trim()||void 0}).then(()=>{f(null),x({feedUrl:"",title:""})}).catch(y=>{console.error("Failed to update feed:",y)}):n({feedUrl:h.feedUrl.trim(),title:h.title.trim()||void 0,projectId:e||void 0}).then(()=>{x({feedUrl:"",title:""}),u(!1)}).catch(y=>{console.error("Failed to create feed:",y)}))},v=g=>{f(g),x({feedUrl:g.feedUrl,title:g.title||""})},b=g=>{n({feedUrl:g.url,title:g.title,projectId:e||void 0}).catch(y=>{console.error("Failed to add feed:",y)})},m=g=>{confirm("Are you sure you want to delete this feed?")&&i(g).catch(y=>{console.error("Failed to delete feed:",y)})};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl md:text-2xl font-bold tracking-tight leading-tight",children:"Content Feeds"}),a.jsx("p",{className:"text-ink/70 mt-1 text-sm md:text-base leading-relaxed",children:"Manage RSS feeds and content sources for automated capture"})]}),a.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-1 md:gap-2 px-3 py-1.5 md:px-4 md:py-2 frost-strong hover:frost-card hover:scale-[1.02] rounded-lg transition-all duration-200 glass-shadow text-sm md:text-base text-ink",children:[a.jsx(Kr,{className:"w-3 h-3 md:w-4 md:h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Add Feed"}),a.jsx("span",{className:"sm:hidden",children:"Add"})]})]}),a.jsx(Be,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-medium",children:"Suggested Feeds"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:t5.map(g=>a.jsxs("button",{onClick:()=>b(g),className:"p-3 glass rounded-lg hover:frost-subtle hover:scale-[1.02] transition-all duration-200 text-left touch-target",children:[a.jsx("div",{className:"font-medium text-sm",children:g.title}),a.jsx("div",{className:"text-xs text-ink/50 truncate mt-1",children:new URL(g.url).hostname})]},g.url))})]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h2",{className:"text-lg font-semibold",children:["Active Feeds (",t.filter(g=>g.isActive).length,")"]}),l?a.jsx(Xl,{count:4,variant:"list"}):t.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(Ad,{className:"w-8 h-8 text-ink/50"})}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No feeds configured"}),a.jsx("p",{className:"text-ink/70 mb-6",children:"Add RSS feeds to automatically capture content for analysis."}),a.jsx("button",{onClick:()=>u(!0),className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 hover:scale-[1.02] rounded-lg transition-all duration-200",children:"Add Your First Feed"})]}):a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-4",children:t.map((g,y)=>a.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:y*.05},children:a.jsx(Be,{className:"group",children:a.jsxs("div",{className:"flex items-start gap-3 md:gap-4",children:[a.jsx("div",{className:`p-2 rounded-lg ${g.isActive?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:a.jsx(Ad,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"text-sm md:text-base font-medium truncate",children:g.title||new URL(g.feedUrl).hostname}),a.jsx("p",{className:"text-sm text-ink/70 truncate mt-1",children:g.feedUrl}),a.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-ink/50",children:[a.jsxs("span",{className:"hidden md:inline",children:["Added ",new Date(g.createdAt).toLocaleDateString()]}),a.jsxs("a",{href:g.feedUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 hover:text-ink/80 transition-colors touch-target",children:[a.jsx(sr,{className:"w-3 h-3"}),a.jsx("span",{className:"hidden md:inline",children:"View Feed"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[a.jsx("button",{onClick:()=>s({id:g.id,isActive:!g.isActive}).catch(console.error),className:`p-1 rounded transition-colors ${g.isActive?"text-green-400 hover:text-green-300":"text-gray-400 hover:text-gray-300"}`,title:g.isActive?"Disable feed":"Enable feed",children:g.isActive?a.jsx(iT,{className:"w-5 h-5"}):a.jsx(sT,{className:"w-5 h-5"})}),a.jsxs(zr,{trigger:a.jsx("button",{className:"p-1 opacity-0 group-hover:opacity-100 md:opacity-100 hover:bg-white/10 rounded transition-all touch-target",children:a.jsx(yo,{className:"w-4 h-4"})}),align:"right",children:[a.jsx(we,{onClick:()=>v(g),icon:a.jsx(jh,{className:"w-4 h-4"}),children:"Edit Feed"}),a.jsx(we,{onClick:()=>m(g.id),icon:a.jsx(kh,{className:"w-4 h-4"}),destructive:!0,children:"Delete Feed"})]})]})]})})},g.id))})]})]}),a.jsx(Mt,{children:(c||d)&&a.jsx(_.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{u(!1),f(null),x({feedUrl:"",title:""})},children:a.jsxs(_.div,{className:"glass rounded-2xl p-6 w-full max-w-md mx-4",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:g=>g.stopPropagation(),children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:d?"Edit Feed":"Add New Feed"}),a.jsxs("form",{onSubmit:w,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Feed URL *"}),a.jsx("input",{type:"url",value:h.feedUrl,onChange:g=>x(y=>({...y,feedUrl:g.target.value})),placeholder:"https://example.com/rss",className:"w-full px-3 py-2 glass rounded-lg bg-transparent outline-none focus:ring-2 focus:ring-blue-500/50",autoFocus:!0,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Custom Title"}),a.jsx("input",{type:"text",value:h.title,onChange:g=>x(y=>({...y,title:g.target.value})),placeholder:"Optional custom name for this feed",className:"w-full px-3 py-2 glass rounded-lg bg-transparent outline-none focus:ring-2 focus:ring-blue-500/50"})]}),a.jsxs("div",{className:"flex gap-3 pt-2",children:[a.jsx("button",{type:"button",onClick:()=>{u(!1),f(null),x({feedUrl:"",title:""})},className:"flex-1 px-4 py-2 glass rounded-lg hover:bg-white/10 transition-colors",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:!h.feedUrl.trim()||o,className:"flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors",children:o?"Saving...":d?"Update":"Add Feed"})]})]})]})})})]})}function r5(){const[e,t]=p.useState([]),[n,r]=p.useState(null),[s,i]=p.useState(!1),[o,l]=p.useState(!1),[c,u]=p.useState(null);p.useEffect(()=>{d()},[]);const d=async()=>{try{const m=await fetch("/api/extension/devices",{credentials:"include"});if(m.ok){const g=await m.json();t(g.data||[])}}catch(m){console.error("Failed to fetch devices:",m)}},f=async()=>{i(!0),u(null);try{const m=await fetch("/api/extension/pairing-codes",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({label:"Chrome Extension",ttlSeconds:600})});if(m.ok){const g=await m.json();r(g)}else{const g=await m.json();u(g.message||"Failed to generate pairing code")}}catch{u("Network error generating pairing code")}finally{i(!1)}},h=async()=>{n!=null&&n.code&&(await navigator.clipboard.writeText(n.code),l(!0),setTimeout(()=>l(!1),2e3))},x=async m=>{try{(await fetch(`/api/extension/devices/${m}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({revoke:!0})})).ok&&t(e.filter(y=>y.id!==m))}catch(g){console.error("Failed to revoke device:",g)}},w=m=>new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),v=m=>m!=null&&m.toLowerCase().includes("mobile")||m!=null&&m.toLowerCase().includes("phone")?JP:WP,b=()=>n?new Date>new Date(n.expiresAt):!0;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Chrome Extension"}),a.jsx("p",{className:"text-ink/70 text-sm",children:"Manage your Chrome Extension connections and generate pairing codes for new devices."})]}),c&&a.jsx("div",{className:"p-4 glass rounded-lg border border-red-500/20 bg-red-500/10",children:a.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[a.jsx(ai,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:c})]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"font-medium",children:"Pair New Extension"}),a.jsxs("button",{onClick:f,disabled:s||n!==null&&!b(),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors flex items-center gap-2",children:[a.jsx(Kr,{className:"w-4 h-4"}),s?"Generating...":"Generate Code"]})]}),a.jsx(Mt,{children:n&&!b()&&a.jsxs(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"p-4 glass rounded-lg border border-blue-500/20 bg-blue-500/10",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-blue-400 mb-1",children:"Pairing Code"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("code",{className:"px-3 py-2 bg-black/20 rounded font-mono text-lg tracking-widest text-blue-300",children:n.code}),a.jsx("button",{onClick:h,className:"p-2 hover:bg-white/10 rounded transition-colors",title:"Copy code",children:o?a.jsx(MP,{className:"w-4 h-4 text-green-400"}):a.jsx(vl,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"text-xs text-ink/60 mt-2",children:["Expires in ",Math.ceil((new Date(n.expiresAt).getTime()-Date.now())/6e4)," minutes"]})]}),a.jsx("div",{className:"text-4xl opacity-20",children:a.jsx(kg,{})})]}),a.jsxs("div",{className:"mt-3 p-3 bg-black/20 rounded text-xs text-ink/70",children:[a.jsx("strong",{children:"Instructions:"})," Open your Chrome Extension settings and enter this code to connect."]})]})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-medium",children:"Connected Devices"}),e.length===0?a.jsxs("div",{className:"p-8 glass rounded-lg text-center",children:[a.jsx(kg,{className:"w-12 h-12 mx-auto mb-4 opacity-40"}),a.jsx("div",{className:"font-medium mb-2",children:"No devices connected"}),a.jsx("div",{className:"text-sm text-ink/70",children:"Generate a pairing code to connect your first Chrome Extension."})]}):a.jsx("div",{className:"space-y-3",children:e.map(m=>{const g=v(m.label);return a.jsxs(_.div,{layout:!0,className:"flex items-center justify-between p-4 glass rounded-lg hover:frost-subtle transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 frost-subtle rounded-lg",children:a.jsx(g,{className:"w-4 h-4"})}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:m.label||"Chrome Extension"}),a.jsxs("div",{className:"text-sm text-ink/70",children:["Connected ",w(m.created_at),m.last_active&&a.jsxs("span",{children:["  Last active ",w(m.last_active)]})]})]})]}),a.jsx("button",{onClick:()=>x(m.id),className:"px-3 py-1 text-sm bg-red-500/20 text-red-400 rounded hover:bg-red-500/30 transition-colors",children:"Revoke"})]},m.id)})})]}),a.jsxs("div",{className:"p-4 glass rounded-lg",children:[a.jsx("h4",{className:"font-medium mb-2",children:"About Chrome Extension"}),a.jsx("p",{className:"text-sm text-ink/70 mb-3",children:"The Content Radar Chrome Extension lets you capture content directly from any webpage, automatically analyze it with AI, and add it to your Content Radar workspace."}),a.jsx("div",{className:"text-xs text-ink/60",children:" Instant capture   Secure authentication   AI-powered analysis"})]})]})}function s5(){const{user:e}=zf(),[t,n]=p.useState("profile"),r=[{id:"profile",title:"Profile",icon:Ki},{id:"tokens",title:"API Tokens",icon:BP},{id:"appearance",title:"Appearance",icon:QP},{id:"shortcuts",title:"Shortcuts",icon:UP},{id:"notifications",title:"Notifications",icon:P1},{id:"privacy",title:"Privacy",icon:ZP}],s=[{keys:["","K"],description:"Open command palette"},{keys:["","S"],description:"Save current work"},{keys:["G"],description:"Toggle grid in canvas"},{keys:["","Z"],description:"Undo"},{keys:["","","Z"],description:"Redo"},{keys:[""],description:"Delete selected blocks"},{keys:["","D"],description:"Duplicate selected blocks"},{keys:["","","",""],description:"Nudge selected blocks"},{keys:["","","","",""],description:"Nudge selected blocks (10px)"}],i=()=>{switch(t){case"profile":return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[e!=null&&e.avatar_url?a.jsx("img",{src:e.avatar_url,alt:e.name||e.email,className:"w-16 h-16 rounded-full"}):a.jsx("div",{className:"w-16 h-16 frost-subtle rounded-full flex items-center justify-center",children:a.jsx(Ki,{className:"w-8 h-8"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",children:(e==null?void 0:e.name)||"User"}),a.jsx("p",{className:"text-ink/70",children:e==null?void 0:e.email})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Display Name"}),a.jsx("input",{type:"text",defaultValue:(e==null?void 0:e.name)||"",className:"w-full px-3 py-2 glass rounded-lg bg-transparent outline-none focus:ring-2 glass-border-focus",placeholder:"Enter your display name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email"}),a.jsx("input",{type:"email",defaultValue:(e==null?void 0:e.email)||"",disabled:!0,className:"w-full px-3 py-2 glass rounded-lg bg-transparent outline-none opacity-50 cursor-not-allowed"}),a.jsx("p",{className:"text-xs text-ink/50 mt-1",children:"Email cannot be changed"})]}),a.jsx("button",{className:"px-4 py-2 frost-strong hover:frost-card rounded-lg transition-colors text-ink",children:"Save Changes"})]})]});case"tokens":return a.jsx(r5,{});case"appearance":return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Theme"}),a.jsx("p",{className:"text-ink/70 text-sm mb-4",children:"Customize the appearance of Content Radar."}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{className:"p-4 glass rounded-lg border-2 border-blue-500/50 bg-blue-500/10",children:[a.jsx("div",{className:"w-full h-20 bg-gradient-to-br from-gray-900 to-gray-800 rounded mb-2"}),a.jsx("div",{className:"text-sm font-medium",children:"Dark (Current)"})]}),a.jsxs("button",{className:"p-4 glass rounded-lg hover:frost-subtle transition-colors",children:[a.jsx("div",{className:"w-full h-20 bg-gradient-to-br from-gray-100 to-gray-200 rounded mb-2"}),a.jsx("div",{className:"text-sm font-medium",children:"Light (Coming Soon)"})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Density"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"radio",name:"density",value:"comfortable",defaultChecked:!0,className:"text-blue-500"}),a.jsx("span",{children:"Comfortable"})]}),a.jsxs("label",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"radio",name:"density",value:"compact",className:"text-blue-500"}),a.jsx("span",{children:"Compact"})]})]})]})]});case"shortcuts":return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Keyboard Shortcuts"}),a.jsx("p",{className:"text-ink/70 text-sm",children:"Learn the keyboard shortcuts to work more efficiently."})]}),a.jsx("div",{className:"space-y-3",children:s.map((o,l)=>a.jsxs("div",{className:"flex items-center justify-between p-3 glass rounded-lg",children:[a.jsx("span",{className:"text-sm",children:o.description}),a.jsx("div",{className:"flex items-center gap-1",children:o.keys.map((c,u)=>a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-2 py-1 text-xs font-mono frost-subtle rounded glass-border text-ink",children:c}),u<o.keys.length-1&&a.jsx("span",{className:"text-xs text-ink/50",children:"+"})]},u))})]},l))})]});case"notifications":return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Notification Preferences"}),a.jsx("p",{className:"text-ink/70 text-sm",children:"Choose what notifications you'd like to receive."})]}),a.jsx("div",{className:"space-y-4",children:[{title:"Export Complete",description:"When brief exports finish processing"},{title:"New Captures",description:"When new content is captured from feeds"},{title:"Cultural Moments",description:"When new moments are detected"},{title:"System Updates",description:"Important system announcements"}].map((o,l)=>a.jsxs("label",{className:"flex items-start gap-3 p-3 glass rounded-lg cursor-pointer hover:frost-subtle transition-colors",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0,className:"mt-1 text-blue-500"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:o.title}),a.jsx("div",{className:"text-sm text-ink/70",children:o.description})]})]},l))})]});case"privacy":return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Privacy & Data"}),a.jsx("p",{className:"text-ink/70 text-sm",children:"Control how your data is used and stored."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"p-4 glass rounded-lg",children:[a.jsx("h4",{className:"font-medium mb-2",children:"Data Export"}),a.jsx("p",{className:"text-sm text-ink/70 mb-3",children:"Download all your data including projects, captures, and briefs."}),a.jsx("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors",children:"Export Data"})]}),a.jsxs("div",{className:"p-4 glass rounded-lg border border-red-500/20",children:[a.jsx("h4",{className:"font-medium mb-2 text-red-400",children:"Delete Account"}),a.jsx("p",{className:"text-sm text-ink/70 mb-3",children:"Permanently delete your account and all associated data. This action cannot be undone."}),a.jsx("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition-colors",children:"Delete Account"})]})]})]});default:return null}};return a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 md:gap-6",children:[a.jsx("div",{className:"lg:col-span-1",children:a.jsx(Be,{children:a.jsx("nav",{className:"grid grid-cols-2 lg:grid-cols-1 gap-1 lg:space-y-1",children:r.map(o=>a.jsxs("button",{onClick:()=>n(o.id),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-all duration-200 leading-relaxed ${t===o.id?"bg-blue-500/20 text-blue-400":"hover:bg-white/5 focus:bg-white/5 focus:outline-none focus:ring-2 focus:ring-blue-500/50"} touch-target`,children:[a.jsx(o.icon,{className:"w-4 h-4"}),a.jsx("span",{className:"text-xs md:text-sm",children:o.title})]},o.id))})})}),a.jsx("div",{className:"lg:col-span-3",children:a.jsx(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3},children:a.jsx(Be,{children:i()})},t)})]})})}function i5(){const[,e]=ni();return a.jsx("div",{className:"min-h-screen flex items-center justify-center app-bg p-6",children:a.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:a.jsxs(Be,{className:"max-w-md text-center",children:[a.jsx("div",{className:"w-20 h-20 frost-subtle rounded-full flex items-center justify-center mx-auto mb-6",children:a.jsx("span",{className:"text-3xl font-bold text-ink",children:"404"})}),a.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Page Not Found"}),a.jsx("p",{className:"text-ink/70 mb-8",children:"The page you're looking for doesn't exist or has been moved."}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center gap-2 px-4 py-2 glass glass-hover rounded-lg transition-colors",children:[a.jsx(wh,{className:"w-4 h-4"}),"Go Back"]}),a.jsxs("button",{onClick:()=>e("/"),className:"flex items-center gap-2 px-4 py-2 frost-strong glass-hover rounded-lg transition-colors",children:[a.jsx(M1,{className:"w-4 h-4"}),"Home"]})]})]})})})}function o5({onFilesSelected:e,className:t,maxFiles:n=10,acceptedTypes:r=["image/*","application/pdf","text/plain",".docx",".doc"]}){const[s,i]=p.useState(!1),o=p.useCallback(d=>{d.preventDefault(),i(!0)},[]),l=p.useCallback(d=>{d.preventDefault(),i(!1)},[]),c=p.useCallback(d=>{d.preventDefault(),i(!1);const f=Array.from(d.dataTransfer.files).slice(0,n);f.length>0&&e(f)},[e,n]),u=p.useCallback(d=>{const f=Array.from(d.target.files||[]).slice(0,n);f.length>0&&e(f)},[e,n]);return a.jsx("div",{className:rt("frost-card border-2 border-dashed transition-all duration-200",s?"border-blue-400 bg-blue-50/10 dark:bg-blue-900/10":"border-gray-300 dark:border-gray-600 hover:border-gray-400",t),onDragOver:o,onDragLeave:l,onDrop:c,"data-testid":"file-drop-zone",children:a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[a.jsx("div",{className:"frost-subtle rounded-full p-3 mb-4",children:a.jsx(Ql,{className:"w-8 h-8 text-gray-500"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Drop files here or click to upload"}),a.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Support for images, PDFs, and documents (max ",n," files)"]}),a.jsxs("label",{className:"frost-card hover:frost-strong cursor-pointer px-4 py-2 rounded-lg transition-all",children:[a.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Choose Files"}),a.jsx("input",{type:"file",multiple:!0,accept:r.join(","),onChange:u,className:"hidden","data-testid":"file-input"})]}),a.jsxs("div",{className:"flex items-center gap-4 mt-6 text-xs text-gray-400",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Ys,{className:"w-4 h-4"}),a.jsx("span",{children:"Images"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(oi,{className:"w-4 h-4"}),a.jsx("span",{children:"PDFs"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(A1,{className:"w-4 h-4"}),a.jsx("span",{children:"Docs"})]})]})]})})}function a5({file:e,note:t="",title:n="",onRemove:r,onNoteChange:s,onTitleChange:i,className:o}){const[l,c]=p.useState(!1),[u,d]=p.useState(t),[f,h]=p.useState(n||e.name),x=()=>e.type.startsWith("image/")?a.jsx(Ys,{className:"w-5 h-5 text-blue-500"}):e.type.includes("pdf")?a.jsx(oi,{className:"w-5 h-5 text-red-500"}):a.jsx(A1,{className:"w-5 h-5 text-gray-500"}),w=m=>{if(m===0)return"0 Bytes";const g=1024,y=["Bytes","KB","MB","GB"],j=Math.floor(Math.log(m)/Math.log(g));return parseFloat((m/Math.pow(g,j)).toFixed(2))+" "+y[j]},v=()=>{i(f),s(u),c(!1)},b=()=>{h(n||e.name),d(t),c(!1)};return a.jsx("div",{className:rt("frost-card border",o),"data-testid":`file-row-${e.name}`,children:a.jsxs("div",{className:"flex items-start gap-3 p-4",children:[a.jsx("div",{className:"frost-subtle rounded-lg p-2",children:x()}),a.jsx("div",{className:"flex-1 min-w-0",children:l?a.jsxs("div",{className:"space-y-3",children:[a.jsx("input",{type:"text",value:f,onChange:m=>h(m.target.value),className:"w-full px-3 py-2 frost-card border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"File title...","data-testid":"file-title-input"}),a.jsx("textarea",{value:u,onChange:m=>d(m.target.value),className:"w-full px-3 py-2 frost-card border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:2,placeholder:"Add a note for this file...","data-testid":"file-note-input"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:v,className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-lg transition-colors","data-testid":"file-save-button",children:"Save"}),a.jsx("button",{onClick:b,className:"px-3 py-1 frost-card hover:frost-strong text-xs rounded-lg transition-colors","data-testid":"file-cancel-button",children:"Cancel"})]})]}):a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:f}),a.jsx("button",{onClick:()=>c(!0),className:"p-1 hover:frost-subtle rounded transition-colors","data-testid":"file-edit-button",children:a.jsx(qP,{className:"w-3 h-3 text-gray-400"})})]}),a.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:[w(e.size),"  ",e.type||"Unknown type"]}),u&&a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 rounded-lg p-2 mt-2",children:u}),!u&&a.jsx("button",{onClick:()=>c(!0),className:"text-xs text-gray-400 hover:text-gray-600 transition-colors","data-testid":"add-note-button",children:"+ Add note"})]})}),a.jsx("button",{onClick:r,className:"p-1 hover:frost-subtle rounded transition-colors text-gray-400 hover:text-red-500","data-testid":"file-remove-button",children:a.jsx(ai,{className:"w-4 h-4"})})]})})}function l5({projectId:e,onUploadComplete:t,className:n}){const[r,s]=p.useState([]),[i,o]=p.useState(!1),[l,c]=p.useState(null),[u,d]=p.useState(null),f=b=>{const m=b.map(g=>({file:g,note:"",title:g.name}));s(g=>[...g,...m]),c(null),d(null)},h=b=>{s(m=>m.filter((g,y)=>y!==b))},x=(b,m)=>{s(g=>g.map((y,j)=>j===b?{...y,note:m}:y))},w=(b,m)=>{s(g=>g.map((y,j)=>j===b?{...y,title:m}:y))},v=async()=>{if(r.length!==0){o(!0),c(null),d(null);try{const b=await uploadCaptures(e,r.map(({file:m,note:g,title:y})=>({file:m,note:g||void 0,title:y||void 0})));d(`Successfully uploaded ${b.created.length} file(s)`),s([]),t&&t(b)}catch(b){c(b instanceof Error?b.message:"Upload failed")}finally{o(!1)}}};return a.jsxs("div",{className:rt("space-y-6",n),"data-testid":"upload-panel",children:[a.jsx(o5,{onFilesSelected:f}),r.length>0&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:["Files to Upload (",r.length,")"]}),a.jsx("button",{onClick:()=>s([]),className:"text-sm text-gray-500 hover:text-gray-700 transition-colors","data-testid":"clear-all-button",children:"Clear All"})]}),a.jsx("div",{className:"space-y-3",children:r.map((b,m)=>a.jsx(a5,{file:b.file,note:b.note,title:b.title,onRemove:()=>h(m),onNoteChange:g=>x(m,g),onTitleChange:g=>w(m,g)},`${b.file.name}-${m}`))}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"text-sm text-gray-500",children:["Ready to upload ",r.length," file(s)"]}),a.jsx("button",{onClick:v,disabled:i||r.length===0,className:rt("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",i||r.length===0?"frost-card text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),"data-testid":"upload-button",children:i?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Uploading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Ql,{className:"w-4 h-4"}),"Upload Files"]})})]})]}),l&&a.jsxs("div",{className:"frost-card border border-red-200 dark:border-red-800 p-4 rounded-lg","data-testid":"error-message",children:[a.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400",children:[a.jsx(LP,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium",children:"Upload Failed"})]}),a.jsx("p",{className:"text-sm text-red-500 dark:text-red-300 mt-1",children:l})]}),u&&a.jsx("div",{className:"frost-card border border-green-200 dark:border-green-800 p-4 rounded-lg","data-testid":"success-message",children:a.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[a.jsx(xl,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium",children:u})]})})]})}function c5(){const{projectId:e}=Rx(),[,t]=ni();if(!e)return a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"frost-card p-8 text-center",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Project Not Found"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"The project ID is missing or invalid."}),a.jsx(gt,{href:"/projects",className:"text-blue-600 hover:text-blue-700 transition-colors",children:"Return to Projects"})]})});const n=r=>{console.log("Upload completed:",r),setTimeout(()=>{t(`/projects/${e}/captures`)},2e3)};return a.jsxs("div",{className:"min-h-screen frost-subtle",children:[a.jsx("div",{className:"border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("div",{className:"frost-subtle p-2 rounded-lg",children:a.jsx(Ql,{className:"w-6 h-6 text-blue-600"})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Files"})]}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Add documents, images, and files to your project"})]})}),a.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs(gt,{href:`/projects/${e}`,className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors","data-testid":"back-to-project",children:[a.jsx(wh,{className:"w-4 h-4"}),"Back to Project"]})}),a.jsxs("div",{className:"frost-card p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Upload Project Files"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Upload documents, images, PDFs, and other files to analyze and include in your strategic briefs. You can add notes to each file to provide context and insights."})]}),a.jsx(l5,{projectId:e,onUploadComplete:n})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[a.jsxs(gt,{href:`/projects/${e}/captures`,className:"frost-card hover:frost-strong p-4 text-center transition-all","data-testid":"view-captures",children:[a.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-1",children:"View All Captures"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Browse uploaded files and captures"})]}),a.jsxs(gt,{href:"/truth-lab",className:"frost-card hover:frost-strong p-4 text-center transition-all","data-testid":"truth-lab-link",children:[a.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-1",children:"Truth Lab"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Analyze URLs, text, and images"})]}),a.jsxs(gt,{href:`/projects/${e}/brief`,className:"frost-card hover:frost-strong p-4 text-center transition-all","data-testid":"brief-canvas-link",children:[a.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-1",children:"Brief Canvas"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Create strategic presentations"})]})]})]})]})}async function u5(e){if($t)return{id:"mock-truth-1",status:"done",verdict:"unverified",confidence:.62,summary:{},created_at:new Date().toISOString()};if(e.file){const t=new FormData;return e.projectId&&t.append("projectId",e.projectId),t.append("kind","image"),t.append("file",e.file),xt.request("/api/truth-checks",{method:"POST",body:t})}else return xt.request("/api/truth-checks",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}async function d5(e){return $t?{id:e,status:"done",verdict:"likely_true",confidence:.8,summary:{}}:xt.request(`/api/truth-checks/${e}`)}async function f5(e){const t=new URLSearchParams;return t.set("page",String(e.page)),t.set("pageSize",String(e.pageSize)),$t?{data:[],page:1,pageSize:20,total:0}:xt.request(`/api/truth-checks?${t}`)}async function h5(e){return xt.request(`/api/truth-checks/${e}/retry`,{method:"POST"})}function p5({onAnalysisStart:e,projectId:t,className:n}){const[r,s]=p.useState("url"),[i,o]=p.useState(!1),[l,c]=p.useState(null),[u,d]=p.useState(""),[f,h]=p.useState(""),[x,w]=p.useState(null),v=[{id:"url",label:"URL Analysis",icon:sr},{id:"text",label:"Text Analysis",icon:Sh},{id:"image",label:"Visual Check",icon:Ys}],b=async()=>{o(!0),c(null);try{let y={kind:r};if(t&&(y.projectId=t),r==="url"){if(!u.trim())throw new Error("Please enter a URL to analyze");y.url=u.trim()}else if(r==="text"){if(!f.trim())throw new Error("Please enter text to analyze");y.text=f.trim()}else if(r==="image"){if(!x)throw new Error("Please select an image to analyze");y.file=x}const j=await u5(y);d(""),h(""),w(null),e&&e(j)}catch(y){c(y instanceof Error?y.message:"Analysis failed")}finally{o(!1)}},m=y=>{var S;const j=(S=y.target.files)==null?void 0:S[0];j&&w(j)},g=()=>r==="url"?u.trim().length>0:r==="text"?f.trim().length>0:r==="image"?x!==null:!1;return a.jsxs("div",{className:rt("frost-card",n),"data-testid":"truth-tabs",children:[a.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:a.jsx("div",{className:"flex space-x-8 px-6",children:v.map(y=>{const j=y.icon;return a.jsxs("button",{onClick:()=>s(y.id),className:rt("flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors",r===y.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),"data-testid":`truth-tab-${y.id}`,children:[a.jsx(j,{className:"w-4 h-4"}),y.label]},y.id)})})}),a.jsxs("div",{className:"p-6",children:[r==="url"&&a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"URL to Analyze"}),a.jsx("input",{type:"url",value:u,onChange:y=>d(y.target.value),placeholder:"https://example.com/article",className:"w-full px-3 py-2 frost-card border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","data-testid":"url-input"})]})}),r==="text"&&a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Text to Analyze"}),a.jsx("textarea",{value:f,onChange:y=>h(y.target.value),placeholder:"Enter the text content you want to fact-check...",rows:6,className:"w-full px-3 py-2 frost-card border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none","data-testid":"text-input"}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[f.length," characters"]})]})}),r==="image"&&a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Image to Analyze"}),a.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6",children:x?a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"frost-subtle rounded-lg p-2 inline-flex items-center gap-2 mb-2",children:[a.jsx(Ys,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:x.name})]}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[(x.size/1024/1024).toFixed(2)," MB"]}),a.jsx("button",{onClick:()=>w(null),className:"text-sm text-red-600 hover:text-red-700 transition-colors","data-testid":"remove-file-button",children:"Remove File"})]}):a.jsxs("div",{className:"text-center",children:[a.jsx(Ql,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsxs("label",{className:"cursor-pointer",children:[a.jsx("span",{className:"text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors",children:"Choose Image File"}),a.jsx("input",{type:"file",accept:"image/*",onChange:m,className:"hidden","data-testid":"image-file-input"})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"PNG, JPG, GIF up to 50MB"})]})})]})}),l&&a.jsx("div",{className:"frost-card border border-red-200 dark:border-red-800 p-3 rounded-lg bg-red-50 dark:bg-red-900/20",children:a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:l})}),a.jsx("div",{className:"flex justify-end pt-4",children:a.jsx("button",{onClick:b,disabled:!g()||i,className:rt("flex items-center gap-2 px-6 py-2 rounded-lg font-medium transition-all",g()&&!i?"bg-blue-600 hover:bg-blue-700 text-white":"frost-card text-gray-400 cursor-not-allowed"),"data-testid":"analyze-button",children:i?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Analyzing..."]}):a.jsxs(a.Fragment,{children:["Analyze ",r==="url"?"URL":r==="text"?"Text":"Image"]})})})]})]})}function Xw({verdict:e,className:t}){const r=(i=>{switch(i){case"likely_true":return{icon:xl,label:"Likely True",className:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border-green-200 dark:border-green-800"};case"misleading":return{icon:Rd,label:"Misleading",className:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800"};case"likely_false":return{icon:OP,label:"Likely False",className:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 border-red-200 dark:border-red-800"};case"unverified":default:return{icon:IP,label:"Unverified",className:"bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300 border-gray-200 dark:border-gray-800"}}})(e),s=r.icon;return a.jsxs("div",{className:rt("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border",r.className,t),"data-testid":`verdict-badge-${e||"unverified"}`,children:[a.jsx(s,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:r.label})]})}function Zw({confidence:e,className:t,showLabel:n=!0}){const r=e||0,s=Math.round(r*100),i=l=>l>=.8?"bg-green-500":l>=.6?"bg-yellow-500":l>=.4?"bg-orange-500":"bg-red-500",o=l=>l>=.8?"High":l>=.6?"Medium":l>=.4?"Low":"Very Low";return a.jsxs("div",{className:rt("space-y-1",t),"data-testid":"confidence-bar",children:[n&&a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Confidence"}),a.jsxs("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[s,"% (",o(r),")"]})]}),a.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:rt("h-2 rounded-full transition-all duration-300",i(r)),style:{width:`${s}%`},"data-testid":"confidence-fill"})})]})}function m5({truthCheck:e,onClick:t,className:n}){const r=o=>{switch(o){case"url":return a.jsx(sr,{className:"w-4 h-4"});case"text":return a.jsx(Sh,{className:"w-4 h-4"});case"image":return a.jsx(Ys,{className:"w-4 h-4"});default:return a.jsx(oi,{className:"w-4 h-4"})}},s=o=>{switch(o){case"done":return"text-green-600 dark:text-green-400";case"error":return"text-red-600 dark:text-red-400";case"processing":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}},i=o=>new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return a.jsx("div",{className:rt("frost-card border hover:frost-strong transition-all cursor-pointer",n),onClick:t,"data-testid":`truth-result-${e.id}`,children:a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"frost-subtle p-1.5 rounded-lg text-gray-600 dark:text-gray-400",children:r(e.kind)}),a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:e.kind}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx("span",{className:rt("text-xs font-medium",s(e.status)),children:e.status}),e.status==="processing"&&a.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"})]})]})]}),e.status==="done"&&e.verdict&&a.jsx(Xw,{verdict:e.verdict})]}),a.jsx("div",{className:"mb-3",children:a.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 line-clamp-2",children:e.input_preview})}),e.status==="done"&&e.confidence!==void 0&&a.jsx("div",{className:"mb-3",children:a.jsx(Zw,{confidence:e.confidence})}),e.status==="error"&&e.error&&a.jsx("div",{className:"mb-3 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:e.error})}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 pt-2 border-t border-gray-100 dark:border-gray-800",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(T1,{className:"w-3 h-3"}),a.jsx("span",{children:i(e.created_at)})]}),e.status==="done"&&a.jsx("span",{className:"text-blue-600 dark:text-blue-400 hover:underline",children:"View Details "})]})]})})}function g5(){const[,e]=ni(),[t,n]=p.useState([]),[r,s]=p.useState(!0);p.useEffect(()=>{i()},[]);const i=async()=>{try{const l=await f5({page:1,pageSize:6});n(l.data||[])}catch(l){console.error("Failed to load recent checks:",l)}finally{s(!1)}},o=l=>{console.log("Analysis started:",l),i()};return a.jsxs("div",{className:"min-h-screen frost-subtle",children:[a.jsx("div",{className:"border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("div",{className:"frost-subtle p-2 rounded-lg",children:a.jsx(Xs,{className:"w-6 h-6 text-blue-600"})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Truth Lab"})]}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Analyze URLs, text content, and images for truth and credibility verification"})]})}),a.jsx("div",{className:"max-w-6xl mx-auto p-6",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Start New Analysis"}),a.jsx(p5,{onAnalysisStart:o})]}),a.jsxs("div",{className:"frost-card p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:"Analysis Insights"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"frost-subtle p-2 rounded-lg",children:a.jsx(bh,{className:"w-4 h-4 text-blue-500"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Average Analysis Time"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"~30 seconds per check"})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"frost-subtle p-2 rounded-lg",children:a.jsx(xo,{className:"w-4 h-4 text-green-500"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Accuracy Rate"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"95%+ verification accuracy"})]})]})]})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Recent Analyses"}),a.jsx(gt,{href:"/truth-lab/history",className:"text-sm text-blue-600 hover:text-blue-700 transition-colors","data-testid":"view-all-analyses",children:"View All "})]}),r?a.jsx("div",{className:"space-y-4",children:[1,2,3].map(l=>a.jsx("div",{className:"frost-card p-4 animate-pulse",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-8 h-8 bg-gray-300 dark:bg-gray-700 rounded-lg"}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"}),a.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-700 rounded w-1/2"})]})]})},l))}):t.length>0?a.jsx("div",{className:"space-y-4",children:t.map(l=>a.jsx(m5,{truthCheck:l,onClick:()=>{e(`/truth-lab/${l.id}`)}},l.id))}):a.jsxs("div",{className:"frost-card p-8 text-center",children:[a.jsx(Xs,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Analyses Yet"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Start your first truth analysis using the panel on the left."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Quick Actions"}),a.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[a.jsxs(gt,{href:"/projects",className:"frost-card hover:frost-strong p-3 text-sm transition-all","data-testid":"projects-link",children:[a.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Analyze Project Files"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Run truth checks on uploaded captures"})]}),a.jsxs(gt,{href:"/chrome-extension",className:"frost-card hover:frost-strong p-3 text-sm transition-all","data-testid":"extension-link",children:[a.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Browser Extension"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Install for instant fact-checking"})]})]})]})]})]})})]})}function y5(){const[,e]=Zj("/truth-lab/:id"),t=e==null?void 0:e.id,[n,r]=p.useState(null),[s,i]=p.useState(!0),[o,l]=p.useState(!1),[c,u]=p.useState(!1);if(console.log("TruthDetailPage params:",e,"id:",t),!t)return a.jsx("div",{className:"max-w-4xl mx-auto p-6",children:a.jsx("div",{className:"glass rounded-xl p-8 text-center",children:a.jsx("div",{className:"text-ink-secondary",children:"Loading truth check details..."})})});p.useEffect(()=>{t&&d()},[t]);const d=async()=>{if(t)try{const w=await d5(t);r(w)}catch(w){console.error("Failed to load truth check:",w)}finally{i(!1)}},f=async()=>{if(t){l(!0);try{await h5(t),await d()}catch(w){console.error("Failed to retry truth check:",w)}finally{l(!1)}}},h=async w=>{try{await navigator.clipboard.writeText(w),u(!0),setTimeout(()=>u(!1),2e3)}catch(v){console.error("Failed to copy text:",v)}},x=w=>new Date(w).toLocaleString();return s?a.jsx("div",{className:"min-h-screen frost-subtle",children:a.jsx("div",{className:"max-w-4xl mx-auto p-6",children:a.jsx("div",{className:"frost-card p-8 animate-pulse",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-300 dark:bg-gray-700 rounded w-1/4"}),a.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"}),a.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-1/2"})]})})})}):n?a.jsxs("div",{className:"min-h-screen frost-subtle",children:[a.jsx("div",{className:"border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg",children:a.jsx("div",{className:"max-w-4xl mx-auto px-6 py-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs(gt,{href:"/truth-lab",className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors","data-testid":"back-to-truth-lab",children:[a.jsx(wh,{className:"w-4 h-4"}),"Truth Lab"]}),a.jsx("div",{className:"h-4 w-px bg-gray-300 dark:bg-gray-600"}),a.jsx(Xw,{verdict:(n==null?void 0:n.verdict)||"unverified"})]}),(n==null?void 0:n.status)==="error"&&a.jsxs("button",{onClick:f,disabled:o,className:"flex items-center gap-2 px-3 py-2 frost-card hover:frost-strong rounded-lg transition-all","data-testid":"retry-button",children:[a.jsx(XP,{className:`w-4 h-4 ${o?"animate-spin":""}`}),"Retry Analysis"]})]})})}),a.jsx("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:a.jsxs("div",{className:"frost-card p-6",children:[a.jsxs("div",{className:"flex items-start justify-between mb-6",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:[n!=null&&n.kind?n.kind.charAt(0).toUpperCase()+n.kind.slice(1):"Content"," Analysis"]}),a.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Analyzed on ",n!=null&&n.created_at?x(n.created_at):"Unknown date"]})]}),a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${(n==null?void 0:n.status)==="done"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":(n==null?void 0:n.status)==="error"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"}`,children:(n==null?void 0:n.status)||"unknown"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-3",children:"Analyzed Content"}),a.jsxs("div",{className:"frost-subtle p-4 rounded-lg",children:[n.kind==="url"&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(sr,{className:"w-4 h-4 text-gray-500"}),a.jsx("a",{href:n.input_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 transition-colors break-all",children:n.input_url}),a.jsx("button",{onClick:()=>h(n.input_url),className:"p-1 hover:frost-subtle rounded transition-colors","data-testid":"copy-url-button",children:c?a.jsx(xl,{className:"w-3 h-3 text-green-500"}):a.jsx(vl,{className:"w-3 h-3 text-gray-400"})})]}),n.kind==="text"&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm text-gray-500",children:"Text Content"}),a.jsxs("button",{onClick:()=>h(n.input_text),className:"flex items-center gap-1 text-xs text-gray-400 hover:text-gray-600 transition-colors","data-testid":"copy-text-button",children:[c?a.jsx(xl,{className:"w-3 h-3 text-green-500"}):a.jsx(vl,{className:"w-3 h-3"}),"Copy"]})]}),a.jsx("p",{className:"text-gray-900 dark:text-gray-100 whitespace-pre-wrap",children:n.input_text})]}),n.kind==="image"&&n.input_file_key&&a.jsx("div",{className:"text-center",children:a.jsx("div",{className:"inline-block frost-card p-3 rounded-lg",children:a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Image file uploaded for analysis"})})})]})]}),n.status==="done"&&a.jsxs("div",{className:"space-y-6",children:[n.confidence!==void 0&&a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-3",children:"Confidence Score"}),a.jsx(Zw,{confidence:n.confidence})]}),n.summary&&a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-3",children:"Analysis Summary"}),a.jsx("div",{className:"frost-subtle p-4 rounded-lg",children:a.jsx("p",{className:"text-gray-900 dark:text-gray-100",children:typeof n.summary=="string"?n.summary:JSON.stringify(n.summary,null,2)})})]}),n.evidence&&n.evidence.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-3",children:["Supporting Evidence (",n.evidence.length,")"]}),a.jsx("div",{className:"space-y-3",children:n.evidence.map((w,v)=>a.jsxs("div",{className:"frost-subtle p-4 rounded-lg",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100",children:w.title}),w.source_url&&a.jsx("a",{href:w.source_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 transition-colors",children:a.jsx(sr,{className:"w-4 h-4"})})]}),w.snippet&&a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:w.snippet})]},w.id||v))})]})]}),n.status==="error"&&n.error&&a.jsxs("div",{className:"frost-card border border-red-200 dark:border-red-800 p-4 rounded-lg bg-red-50 dark:bg-red-900/20",children:[a.jsx("h3",{className:"text-lg font-medium text-red-800 dark:text-red-300 mb-2",children:"Analysis Failed"}),a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.error})]}),n.status==="processing"&&a.jsx("div",{className:"text-center py-8",children:a.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 frost-card rounded-lg",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Analysis in progress..."})]})})]})})]}):a.jsx("div",{className:"min-h-screen frost-subtle",children:a.jsx("div",{className:"max-w-4xl mx-auto p-6",children:a.jsxs("div",{className:"frost-card p-8 text-center",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Truth Check Not Found"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"The requested truth check could not be found."}),a.jsx(gt,{href:"/truth-lab",className:"text-blue-600 hover:text-blue-700 transition-colors",children:"Return to Truth Lab"})]})})})}function x5(){const{isAuthenticated:e,loading:t}=zf();return t?a.jsx("div",{className:"min-h-screen bg-app flex items-center justify-center",children:a.jsx("div",{className:"text-ink",children:"Loading..."})}):a.jsx(I3,{children:a.jsxs(ek,{children:[a.jsx(ct,{path:"/",component:K3}),a.jsx(ct,{path:"/projects",component:Q3}),a.jsx(ct,{path:"/projects/:projectId/upload",component:c5}),a.jsx(ct,{path:"/captures",component:rA}),a.jsx(ct,{path:"/moments",component:sA}),a.jsx(ct,{path:"/briefs",component:iA}),a.jsx(ct,{path:"/briefs/:id",component:qR}),a.jsx(ct,{path:"/feeds",component:n5}),a.jsx(ct,{path:"/truth-lab",component:g5}),a.jsx(ct,{path:"/truth-lab/:id",component:y5}),a.jsx(ct,{path:"/settings",component:s5}),a.jsx(ct,{component:i5})]})})}function v5(){return a.jsx(Bk,{children:a.jsx(Mx,{children:a.jsx("div",{className:"ui-v2",children:a.jsx(x5,{})})})})}bx(document.getElementById("root")).render(a.jsx(rn.StrictMode,{children:a.jsx(v5,{})}));
server/routes.ts:385:  app.post("/api/truth-analysis", async (req, res) => {
server/routes.ts:1433:    "/api/truth-analysis/analyze",
server/routes/truth.ts:16:  app.post('/api/truth/extract', async (req: Request, res: Response) => {
server/routes/truth.ts:45:  app.post('/api/truth/analyze-text/:id', async (req: Request, res: Response) => {
server/routes/truth.ts:100:  app.get('/api/truth/:id', async (req: Request, res: Response) => {
server/scripts/verify-live.ts:141:    const { status, json } = await fetchJson(`${BASE}/api/truth/sample-count`, {

## Client Scoping & UI-V2

- X-Project-ID header set:
client/src/ui-v2/lib/api.ts:43:  if (__scopedProjectId) h.set("X-Project-ID", __scopedProjectId);
- ProjectProvider integration:
client/src/ui-v2/app/providers.tsx:3:import { IS_MOCK_MODE, setScopedProjectId } from "../lib/api";
client/src/ui-v2/app/providers.tsx:18:export function useProjectContext() {
client/src/ui-v2/app/providers.tsx:21:    throw new Error('useProjectContext must be used within a ProjectProvider');
client/src/ui-v2/app/providers.tsx:26:function ProjectProvider({ children }: { children: ReactNode }) {
client/src/ui-v2/app/providers.tsx:30:    setScopedProjectId(currentProjectId);
client/src/ui-v2/app/providers.tsx:81:        <ProjectProvider>
client/src/ui-v2/app/providers.tsx:85:        </ProjectProvider>
client/src/ui-v2/components/layout/ProjectSwitcher.tsx:6:import { useProjectContext } from '../../app/providers';
client/src/ui-v2/components/layout/ProjectSwitcher.tsx:12:  const { currentProjectId, setCurrentProjectId } = useProjectContext();
client/src/ui-v2/hooks/useBriefs.ts:3:import { useProjectContext } from "../app/providers";
client/src/ui-v2/hooks/useBriefs.ts:9:  const { currentProjectId } = useProjectContext();
client/src/ui-v2/hooks/useCaptures.ts:3:import { useProjectContext } from "../app/providers";
client/src/ui-v2/hooks/useCaptures.ts:7:  const { currentProjectId } = useProjectContext();
client/src/ui-v2/hooks/useFeeds.ts:3:import { useProjectContext } from "../app/providers";
client/src/ui-v2/hooks/useFeeds.ts:7:  const { currentProjectId } = useProjectContext();
client/src/ui-v2/hooks/useMoments.ts:3:import { useProjectContext } from "../app/providers";
client/src/ui-v2/hooks/useMoments.ts:7:  const { currentProjectId } = useProjectContext();
client/src/ui-v2/lib/api.ts:14:export function setScopedProjectId(id: string | null) {
client/src/ui-v2/pages/BriefsListPage.tsx:10:import { useProjectContext } from '../app/providers';
client/src/ui-v2/pages/BriefsListPage.tsx:15:  const { currentProjectId } = useProjectContext() || { currentProjectId: null };
client/src/ui-v2/pages/CapturesInboxPage.tsx:10:import { useProjectContext } from '../app/providers';
client/src/ui-v2/pages/CapturesInboxPage.tsx:22:  const { currentProjectId } = useProjectContext();
client/src/ui-v2/pages/DashboardPage.tsx:13:// import { useProjectContext } from '../app/providers';
client/src/ui-v2/pages/FeedsPage.tsx:7:import { useProjectContext } from '../app/providers';
client/src/ui-v2/pages/FeedsPage.tsx:18:  const { currentProjectId } = useProjectContext();
client/src/ui-v2/pages/MomentsRadarPage.tsx:8:import { useProjectContext } from '../app/providers';
client/src/ui-v2/pages/MomentsRadarPage.tsx:13:  const { currentProjectId } = useProjectContext();
client/src/ui-v2/pages/ProjectsPage.tsx:7:import { useProjectContext } from '../app/providers';
client/src/ui-v2/pages/ProjectsPage.tsx:12:  const { currentProjectId, setCurrentProjectId } = useProjectContext();
- Upload workflow (UploadPanel + service):
client/src/ui-v2/components/upload/UploadPanel.tsx:61:      const result = await uploadCaptures(projectId, files.map(({ file, note, title }) => ({
client/src/ui-v2/services/captures.ts:33:export async function uploadCaptures(

## Chrome Extension (permissions & CSP)

- extension/manifest.json (first 60 lines):
  {
    "manifest_version": 3,
    "name": "Content Radar",
    "description": "Capture uploads, one-off truth checks, and visual analysis  in sync with Content Radar.",
    "version": "0.1.0",
    "icons": {
      "16": "icons/icon16.png",
      "32": "icons/icon32.png",
      "48": "icons/icon48.png",
      "128": "icons/icon128.png"
    },
    "action": {
      "default_title": "Content Radar",
      "default_popup": "popup.html"
    },
    "background": {
      "service_worker": "sw.js",
      "type": "module"
    },
    "permissions": ["storage", "contextMenus", "activeTab", "scripting"],
    "host_permissions": [
      "http://localhost:5000/*",
      "https://*.repl.co/*",
      "https://*.replit.dev/*",
      "https://*.supabase.co/*"
    ],
    "content_security_policy": {
      "extension_pages": "script-src 'self'; object-src 'self'; style-src 'self' 'unsafe-inline'; connect-src 'self' http://localhost:5000 https://*.repl.co https://*.replit.dev https://*.supabase.co;"
    },
    "minimum_chrome_version": "114"
  }- Broad permissions scan:
extension/README.md:16:- `activeTab`, `scripting`, `storage`, `tabs`, `tabCapture`, `alarms`
extension/manifest.json:20:  "permissions": ["storage", "contextMenus", "activeTab", "scripting"],

## Environment Variables (string presence check)

- NODE_ENV: production
- VITE_SITE_URL: https://workspace.maz0327.repl.co
- ALLOWED_ORIGINS: (not set)
- CHROME_EXTENSION_ID: (not set)
- SUPABASE_URL: https://uytiwodjtulpjvgjtsod.supabase.co
- SUPABASE_ANON_KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5dGl3b2RqdHVscGp2Z2p0c29kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMzAwNzUsImV4cCI6MjA2OTkwNjA3NX0.p_ss1MSfiy4fuRZV6UqO-y90HWjGiMs78knSX8HSlRM
- SUPABASE_SERVICE_ROLE_KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5dGl3b2RqdHVscGp2Z2p0c29kIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NDMzMDA3NSwiZXhwIjoyMDY5OTA2MDc1fQ.HijOpHThCIzSMDYr2lj1IT0v9KC6ZTm2gDB0kw2DwDE
- SUPABASE_JWT_SECRET: OsgqGuY4byN0QEI8kPPdEFV9pFpkpZ7x+8BNPOjOQcwmNIGhKgfRfS8hQolx4FkJ118E3VIlMv6xudjzpQocLg==
- SUPABASE_STORAGE_BUCKET: media
- RATE_LIMIT_WINDOW_MS: (not set)
- RATE_LIMIT_MAX: (not set)

## Typecheck

```text
server/routes/google-exports.ts(365,39): error TS2339: Property 'session' does not exist on type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(35,16): error TS2339: Property 'session' does not exist on type 'Request<{}, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(39,56): error TS2339: Property 'session' does not exist on type 'Request<{}, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(44,23): error TS2339: Property 'session' does not exist on type 'Request<{}, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(77,16): error TS2339: Property 'session' does not exist on type 'Request<{}, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(84,56): error TS2339: Property 'session' does not exist on type 'Request<{}, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(88,57): error TS2339: Property 'session' does not exist on type 'Request<{}, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(92,23): error TS2339: Property 'session' does not exist on type 'Request<{}, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(110,16): error TS2339: Property 'session' does not exist on type 'Request<{ category: string; }, any, any, ParsedQs, Record<string, any>>'.
server/routes/settings.ts(124,61): error TS2339: Property 'session' does not exist on type 'Request<{ category: string; }, any, any, ParsedQs, Record<string, any>>'.
server/services/google/drive.ts(32,9): error TS2353: Object literal may only specify known properties, and 'q' does not exist in type 'BodyResponseCallback<Schema$FileList>'.
server/services/google/drive.ts(36,26): error TS2339: Property 'data' does not exist on type '{ data: { files: never[]; }; } | (Promise<{ data: { files: never[]; }; }> & void) | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<{ data: { files: never[]; }; }> & void'.
server/services/google/drive.ts(36,55): error TS2339: Property 'data' does not exist on type '{ data: { files: never[]; }; } | (Promise<{ data: { files: never[]; }; }> & void) | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<{ data: { files: never[]; }; }> & void'.
server/services/google/drive.ts(38,31): error TS2339: Property 'data' does not exist on type '{ data: { files: never[]; }; } | (Promise<{ data: { files: never[]; }; }> & void) | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<{ data: { files: never[]; }; }> & void'.
server/services/google/drive.ts(44,9): error TS2353: Object literal may only specify known properties, and 'requestBody' does not exist in type 'BodyResponseCallback<Schema$File>'.
server/services/google/drive.ts(51,29): error TS2339: Property 'data' does not exist on type '{ data: { id: string; webViewLink: string; }; } | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (Promise<{ data: { id: string; webViewLink: string; }; }> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<GaxiosResponseWithHTTP2<Readable>> & void'.
server/services/google/drive.ts(65,9): error TS2353: Object literal may only specify known properties, and 'requestBody' does not exist in type 'BodyResponseCallback<Schema$File>'.
server/services/google/drive.ts(74,26): error TS2339: Property 'data' does not exist on type '{ data: { id: string; webViewLink: string; }; } | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (Promise<{ data: { id: string; webViewLink: string; }; }> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<GaxiosResponseWithHTTP2<Readable>> & void'.
server/services/google/drive.ts(75,31): error TS2339: Property 'data' does not exist on type '{ data: { id: string; webViewLink: string; }; } | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (Promise<{ data: { id: string; webViewLink: string; }; }> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<GaxiosResponseWithHTTP2<Readable>> & void'.
server/services/google/drive.ts(90,9): error TS2353: Object literal may only specify known properties, and 'fileId' does not exist in type 'BodyResponseCallback<Schema$File>'.
server/services/google/drive.ts(94,23): error TS2339: Property 'data' does not exist on type '{ data: { id: any; name: string; webViewLink: string; exportLinks: {}; }; } | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (Promise<{ ...; }> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<GaxiosResponseWithHTTP2<Readable>> & void'.
server/services/google/slides.ts(64,9): error TS2353: Object literal may only specify known properties, and 'requestBody' does not exist in type 'BodyResponseCallback<Schema$Presentation>'.
server/services/google/slides.ts(69,43): error TS2339: Property 'data' does not exist on type '{ data: { presentationId: string; title: any; }; } | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (Promise<{ data: { presentationId: string; title: any; }; }> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<GaxiosResponseWithHTTP2<Readable>> & void'.
server/services/google/slides.ts(75,9): error TS2353: Object literal may only specify known properties, and 'fileId' does not exist in type 'BodyResponseCallback<Schema$File>'.
server/services/google/slides.ts(88,11): error TS2353: Object literal may only specify known properties, and 'presentationId' does not exist in type 'BodyResponseCallback<Schema$Presentation>'.
server/services/google/slides.ts(91,49): error TS2339: Property 'data' does not exist on type '{ data: { presentationId: any; slides: { objectId: string; }[]; }; } | (Promise<GaxiosResponseWithHTTP2<Readable>> & void) | (Promise<{ data: { presentationId: any; slides: { ...; }[]; }; }> & void) | (GaxiosResponseWithHTTP2<...> & { ...; })'.
  Property 'data' does not exist on type 'Promise<GaxiosResponseWithHTTP2<Readable>> & void'.
server/services/google/slides.ts(220,11): error TS2353: Object literal may only specify known properties, and 'presentationId' does not exist in type 'BodyResponseCallback<Schema$BatchUpdatePresentationResponse>'.
server/types/session.ts(3,16): error TS2665: Invalid module name in augmentation. Module 'express-session' resolves to an untyped module at '/home/runner/workspace/node_modules/express-session/index.js', which cannot be augmented.
server/workers/analysis/pipeline.ts(90,7): error TS2322: Type 'string' is not assignable to type '"google" | "openai" | "mock"'.
vite.config.ts(2,19): error TS2307: Cannot find module '@vitejs/plugin-react' or its corresponding type declarations.
ELIFECYCLE Command failed with exit code 2.
```

## Unit Tests

```text
ERR_PNPM_NO_SCRIPT Missing script: test

Command "test" not found. Did you mean "pnpm run start"?
```

## Build

```text

> rest-express@1.0.0 build /home/runner/workspace
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist && esbuild server/prod-server.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

failed to load config from /home/runner/workspace/vite.config.ts
error during build:
Error [ERR_MODULE_NOT_FOUND]: Cannot find package '@vitejs/plugin-react' imported from /home/runner/workspace/vite.config.ts.timestamp-1755716705840-11d4c90e50938.mjs
    at packageResolve (node:internal/modules/esm/resolve:873:9)
    at moduleResolve (node:internal/modules/esm/resolve:946:18)
    at defaultResolve (node:internal/modules/esm/resolve:1188:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:642:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:591:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:574:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:236:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:130:49)
ELIFECYCLE Command failed with exit code 1.
```

## Dependency Vulnerability Summary

```text

```
- esbuild version: 0.25.9 (expect >= 0.24.4)

## Dev Server Probe (5000 API / 5173 Vite)

- /healthz:
  (unavailable)
- /api/daily-briefing (unauth sample, expect 401):
  (unavailable)
- /api/captures (unauth, expect 401):
  (unavailable)
- Vite root (5173):
  (unavailable)

## Common Pitfalls Checklist

- [ ] @vitejs/plugin-react missing or not resolved
- [ ] tsx missing (use npx tsx or add devDep)
- [ ] Tailwind v4 config mismatched (ensure @tailwindcss/postcss in postcss.config.cjs)
- [ ] Two PostCSS configs present (keep only postcss.config.cjs)
- [ ] Auth bypass flags set in production (MOCK_AUTH/VITE_MOCK_AUTH)
- [ ] CORS wildcard or unlisted origins allowed
- [ ] Rate limiting not mounted on /api and /api/auth
- [ ] Project scoping absent (X-Project-ID not set or ignored)
- [ ] Captures upload endpoint missing/broken
- [ ] Daily briefing route missing/broken
- [ ] Esbuild < 0.24.4 (known vuln)
- [ ] Missing error tracking (e.g., Sentry)
- [ ] E2E tests absent (Playwright/Cypress)
- [ ] CDN/caching headers absent on static assets
